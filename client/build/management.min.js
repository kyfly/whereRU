app.controller("ActivityListCtrl",["$scope","Team","$rootScope",function(t,e,a){a.logoHide=!1,t.chosenType="all",t.unFormat="yyyy-MM-dd HH:mm",t.format="yyyy-MM-dd",e.prototype_get_activities({id:localStorage.$LoopBack$currentTeamId,filter:{order:"created DESC"}},function(e){t.activityItems=e},function(){Materialize.toast("获取活动列表失败！",6e3)}),t.deleteActivity=function(){var a=this;e.prototype_updateById_activities({id:localStorage.$LoopBack$currentTeamId,fk:a.activityItem.id},{deleted:!0},function(){Materialize.toast("删除成功！",2e3);var e=a.activityItem.id;for(var i in t.activityItems)t.activityItems[i].id===e&&t.activityItems.splice(i,1)},function(){Materialize.toast("删除失败！",2e3)})}}]),app.controller("ActivityEditCtrl",["$scope","Team","Ueditor","$location","$http","$rootScope","Activity","$stateParams",function(t,e,a,i,o,c,r,d){t.isEdit=!1,t.preType={},""!==d.id&&(t.isEdit=!0,r.findById({id:d.id},function(e){console.log(e),t.activityData=e,o.get(e.explainUrl).success(function(e){t.activityEditorContent=e}),"form"===e.actType?(t.preType={type:"form"},r.prototype_get_forms({id:d.id},function(e){e[0]&&(t.formData=e[0],t.preType.id=e[0].id)})):"vote"===e.actType?(t.preType={type:"vote"},r.prototype_get_votes({id:d.id},function(e){e[0]&&(t.voteData=e[0],t.preType.id=e[0].id)})):"seckill"===e.actType&&(t.preType={type:"seckill"},r.prototype_get_seckills({id:d.id},function(e){e[0]&&(t.seckillData=e[0],t.preType.id=e[0].id)}))})),t.activityData={authorName:c.teamInfo.name,authorId:t.teamInfo.id,type:t.teamInfo.type,school:t.teamInfo.school,created:new Date};var n=new Date;t.minDate=new Date(n.getTime()).toISOString(),t.month=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],t.monthShort=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],t.weekdaysFull=["周日","周一","周二","周三","周四","周五","周六"],t.weekdaysLetter=["日","一","二","三","四","五","六"],t.today="今天",t.clear="清除",t.close="确定";var p=["mainInfo","copywriter","complete"];t.nextStep=function(t){$("#editActivityTabs").tabs("select_tab",p[t])},t.activityImgLoad=function(){var e=document.getElementById("activityImg").files[0],a=new XMLHttpRequest,i=/\.[^\.]+/.exec(document.getElementById("activityImg").value.toLowerCase());if(".png"!==i[0]&&".jpg"!==i[0]&&".jpeg"!==i[0]&&".gif"!==i[0])return alert("请确认您上传的logo文件格式是jpg、png、gif或jpeg"),!1;var o=function(){4===a.readyState&&200===a.status&&(t.activityData.imgUrl="http://cdn-img.etuan.org/"+JSON.parse(a.responseText).url+"@4e_0o_0l_200h_360w_90q.src")},c=new FormData;c.append("img",e),a.onreadystatechange=o,a.open("POST","/ue/uploads?dir=team&id="+localStorage.$LoopBack$currentTeamId+"&action=uploadimage",!0),a.send(c)},t.activityEditorConfig=a.config,t.getFormList=function(){e.prototype_get_forms({id:localStorage.$LoopBack$currentTeamId},function(e){t.formItems=e,t.isActivity=function(e){return!t.formItems[e].activityId}},function(){Materialize.toast("获取表单模板列表失败！",2e3)})},t.getVoteList=function(){e.prototype_get_votes({id:localStorage.$LoopBack$currentTeamId},function(e){t.voteItems=e,t.isActivity=function(e){return!t.voteItems[e].activityId}},function(){Materialize.toast("获取投票模板列表失败！",2e3)})},t.getSeckillList=function(){e.prototype_get_seckills({id:localStorage.$LoopBack$currentTeamId},function(e){t.seckillItems=e,t.isActivity=function(e){return!t.seckillItems[e].activityId}},function(){Materialize.toast("获取抢票模板列表失败！",2e3)})},t.addFormFunc=function(){var e=this;t.formData=e.formItem,$("#addForm").closeModal()},t.addVoteFunc=function(){var e=this;t.voteData=e.voteItem,$("#addVote").closeModal()},t.addSeckillFunc=function(){var e=this;t.seckillData=e.seckillItem,$("#addSeckill").closeModal()},t.removeFormData=function(){t.formData=void 0},t.removeVoteData=function(){t.voteData=void 0},t.removeSeckillData=function(){t.seckillData=void 0},t.createActivity=function(){t.isEdit?o({url:"/ue/uploads?dir=team&id="+localStorage.$LoopBack$currentTeamId+"&action=uploadtext",method:"post",data:{content:t.activityEditorContent}}).success(function(a){t.activityData.explainUrl="http://oss.etuan.org/"+a.url,t.formData?t.activityData.actType="form":t.voteData?t.activityData.actType="vote":t.seckillData?t.activityData.actType="seckill":t.activityData.actType="common",e.prototype_updateById_activities({id:localStorage.$LoopBack$currentTeamId,fk:d.id},t.activityData,function(e){Materialize.toast("更新成功！",2e3),t.formData?(t.formData.updated=new Date,t.formData.id=void 0,t.formData.activityId=d.id,"form"===t.preType.type?r.prototype_updateById_forms({id:e.id,fk:t.preType.id},t.formData):r.prototype_create_forms({id:e.id},t.formData)):"form"===t.preType.type&&r.prototype_delete_forms({id:e.id}),t.voteData?(t.voteData.updated=new Date,t.voteData.id=void 0,t.voteData.activityId=d.id,"vote"===t.preType.type?r.prototype_updateById_votes({id:e.id,fk:t.preType.id},t.voteData):r.prototype_create_votes({id:e.id},t.voteData)):"vote"===t.preType.type&&r.prototype_delete_votes({id:e.id}),t.seckillData?(t.seckillData.updated=new Date,t.seckillData.id=void 0,t.seckillData.activityId=d.id,"seckill"===t.preType.type?r.prototype_updateById_seckills({id:e.id,fk:t.preType.id},t.seckillData):r.prototype_create_seckills({id:e.id},t.seckillData)):"seckill"===t.preType.type&&r.prototype_delete_seckills({id:e.id}),i.path("/MS/activity/list")},function(){Materialize.toast("更新失败！",2e3)})}):o({url:"/ue/uploads?dir=team&id="+localStorage.$LoopBack$currentTeamId+"&action=uploadtext",method:"post",data:{content:t.activityEditorContent}}).success(function(a){t.activityData.explainUrl="http://oss.etuan.org/"+a.url,t.formData?t.activityData.actType="form":t.voteData?t.activityData.actType="vote":t.seckillData?t.activityData.actType="seckill":t.activityData.actType="common",e.prototype_create_activities({id:localStorage.$LoopBack$currentTeamId},t.activityData,function(e){Materialize.toast("创建成功！",2e3),t.formData&&(t.formData.updated=new Date,t.formData.activityId=e.id,t.formData.id=void 0,t.formData.activityId=localStorage.$LoopBack$currentTeamId,r.prototype_create_forms({id:e.id},t.formData)),i.path("/MS/activity/list")},function(){Materialize.toast("创建失败！",2e3)})})}}]);
app.controller("AlbumCtrl",["$scope","$rootScope",function(o,l){l.logoHide=!1}]);
app.controller("EventCtrl",["$scope","Team",function(e,t){function n(e,t){for(var n=new FormData,o=0;o<e.length;o++)file=e[o],n.append(file.name,file);var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&200===a.status&&t(JSON.parse(a.responseText))},a.open("POST","/ue/uploads?action=uploadfile&dynamicPath=contest&files="+e.length,!0),a.send(n)}t.prototype_get_races({id:localStorage.$LoopBack$currentTeamId},function(t){0===t.length&&(e.noEvent=!0),console.log(t,"竞赛"),e.contestLists=t}),e.noEvent=!1,e.contest={},e.explainDocLoad=function(){var t=document.getElementById("explainDoc").files;n(t,function(t){e.contest.explainUrl=t[0].url,e.$apply()})},e.processDocLoad=function(){var t=document.getElementById("processDoc").files;n(t,function(t){e.contest.processUrl=t[0].url,e.$apply()})},e.ruleDocLoad=function(){var t=document.getElementById("ruleDoc").files;n(t,function(t){e.contest.ruleUrl=t[0].url,e.$apply()})},e.addContest=function(){e.contest.name&&e.contest.ruleUrl&&e.contest.processUrl&&e.contest.explainUrl?ContestOrg.contests.create({id:localInfo.userId,access_token:localInfo.id},e.contest,function(){history.go(0)},function(){Materialize.toast("创建失败！",2e3)}):Materialize.toast("请填写完整哦！",2e3)},e.contentType=0,e.contentTypeChange=function(t){e.contentType=t},e.newNotice={},e.uploadAttachment=!1,e.addGetInfo=!1;var o=new Date;e.minDate=new Date(o.getTime()).toISOString(),e.month=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],e.monthShort=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],e.weekdaysFull=["周日","周一","周二","周三","周四","周五","周六"],e.weekdaysLetter=["日","一","二","三","四","五","六"],e.today="今天",e.clear="清除",e.close="确定",e.deadline={}}]);
app.controller("EventListCtrl",["$scope","Team","$rootScope",function(e,t,a){a.logoHide=!1,e.unFormat="yyyy-MM-dd HH:mm",e.format="yyyy-MM-dd",t.prototype_get_races({id:localStorage.$LoopBack$currentTeamId,filter:{order:"created DESC"}},function(t){e.eventItems=t},function(){Materialize.toast("获取创建竞赛列表失败！",6e3)}),t.prototype_get_partakedRaces({id:localStorage.$LoopBack$currentTeamId,filter:{order:"created DESC"}},function(t){e.partakedEventItems=t,e.deletedLength=0;for(var a in e.partakedEventItems)e.partakedEventItems[a].deleted===!0&&e.deletedLength++},function(){Materialize.toast("获取参与竞赛列表失败！",2e3)}),e.showSingleType=function(t){e.allChosen="all"===t},e.deleteEvent=function(){var a=this;t.prototype_updateById_races({id:localStorage.$LoopBack$currentTeamId,fk:a.eventItem.id},{deleted:!0},function(){Materialize.toast("删除成功！",2e3);var t=a.eventItem.id;for(var o in e.eventItems)e.eventItems[o].id===t&&e.eventItems.splice(o,1)},function(){Materialize.toast("删除失败！",2e3)})},e.quitEvent=function(){var a=this;t.prototype_unlink_partakedRaces({id:localStorage.$LoopBack$currentTeamId,fk:a.partakedEventItem.id},{deleted:!0},function(){Materialize.toast("删除成功！",2e3);var t=a.partakedEventItem.id;for(var o in e.partakedEventItems)e.partakedEventItems[o].id===t&&e.partakedEventItems.splice(o,1)},function(){Materialize.toast("删除失败！",2e3)})}}]),app.controller("EventEditCtrl",["$scope","Team","Ueditor","$http","$location",function(e,t,a,o,n){e.eventData={authorName:e.teamInfo.name,authorId:e.teamInfo.id,school:e.teamInfo.school};var i=new Date;e.minDate=new Date(i.getTime()).toISOString(),e.month=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],e.monthShort=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],e.weekdaysFull=["周日","周一","周二","周三","周四","周五","周六"],e.weekdaysLetter=["日","一","二","三","四","五","六"],e.today="今天",e.clear="清除",e.close="确定";var r=["mainInfo","copywriter","complete"];e.nextStep=function(e){$("#editEventTabs").tabs("select_tab",r[e])},e.eventImgLoad=function(){var t=document.getElementById("eventImg").files[0],a=new XMLHttpRequest,o=/\.[^\.]+/.exec(document.getElementById("eventImg").value.toLowerCase());if(".png"!==o[0]&&".jpg"!==o[0]&&".jpeg"!==o[0]&&".gif"!==o[0])return alert("请确认您上传的logo文件格式是jpg、png、gif或jpeg"),!1;var n=function(){4===a.readyState&&200===a.status&&(e.eventData.imgUrl="http://cdn-img.etuan.org/"+JSON.parse(a.responseText).url+"@4e_0o_0l_200h_360w_90q.src")},i=new FormData;i.append("img",t),a.onreadystatechange=n,a.open("POST","/ue/uploads?dir=team&id="+localStorage.$LoopBack$currentTeamId+"&action=uploadimage",!0),a.send(i)},e.eventEditorConfig=a.config,e.createEvent=function(){o({url:"/ue/uploads?dir=team&id="+localStorage.$LoopBack$currentTeamId+"&action=uploadtext",method:"post",data:{content:e.eventEditorContent}}).success(function(a){e.eventData.explainUrl="http://oss.etuan.org/"+a.url,e.eventData.created=new Date,e.eventData.deleted=!1,t.prototype_create_races({id:localStorage.$LoopBack$currentTeamId},e.eventData,function(){Materialize.toast("创建成功！",2e3),n.path("/MS/event/list")},function(){Materialize.toast("创建失败！",2e3)})})}}]),app.controller("EventDetailCtrl",["$scope","Race","$http","$stateParams",function(e,t,a,o){t.findById({id:o.id},function(a){e.raceInfo=a,e.materialInfo={loader:e.raceInfo.authorName,open:!0},e.materialLoad=function(){var t=document.getElementById("addMaterialDoc").files[0],a=new XMLHttpRequest,o=function(){4===a.readyState&&200===a.status&&(e.materialInfo.dataUrl="http://oss.etuan.org/"+JSON.parse(a.responseText).url)},n=new FormData;n.append("text",t),a.onreadystatechange=o,a.open("POST","/ue/uploads?dir=team&id="+localStorage.$LoopBack$currentTeamId+"&action=uploadfile",!0),a.send(n)},e.createMaterial=function(){e.materialInfo.created=new Date,e.materialInfo.name?t.prototype_create_materials({id:o.id},e.materialInfo,function(t){Materialize.toast("上传成功！",2e3),e.materialList.push(t)},function(){Materialize.toast("上传失败！",2e3)}):Materialize.toast("请先选择一个文件哦！",2e3)}}),e.isAuthor="author"===o.type,e.uploadAttachmentBtn=!1,e.addGetInfoBtn=!1,e.newNotice={},t.prototype_get_notices({id:o.id},function(t){e.noticeList=t,e.deletedNum=0;for(var a in e.noticeList)e.noticeList[a].deleted===!0&&e.deletedNum++},function(){Materialize.toast("获取通知列表失败！",2e3)}),e.deleteNotice=function(){var a=this;t.prototype_updateById_notices({id:o.id,fk:a.notice.id},{deleted:!0},function(){Materialize.toast("删除成功！",2e3);var t=a.notice.id;for(var o in e.noticeList)e.noticeList[o].id===t&&e.noticeList.splice(o,1)},function(){Materialize.toast("删除失败！",2e3)})},e.uploadAttachment=function(){var t=document.getElementById("attachmentFile").files[0],a=new XMLHttpRequest,o=function(){4===a.readyState&&200===a.status&&(e.newNotice.attachmentUrl="http://oss.etuan.org/"+JSON.parse(a.responseText).url)},n=new FormData;n.append("text",t),a.onreadystatechange=o,a.open("POST","/ue/uploads?dir=team&id="+localStorage.$LoopBack$currentTeamId+"&action=uploadfile",!0),a.send(n)},e.createNotice=function(){e.newNotice.created=new Date,e.newNotice.content?t.prototype_create_notices({id:o.id},e.newNotice,function(t){Materialize.toast("创建成功！",2e3),e.noticeList.push(t)},function(){Materialize.toast("创建失败！",2e3)}):Materialize.toast("请先填写通知内容哦",2e3)},t.prototype_get_raceTeams({id:o.id},function(t){e.raceTeams=t}),e.deleteRaceTeam=function(){var a=this;t.prototype_unlink_raceTeams({id:o.id,fk:a.raceTeam.id},function(){Materialize.toast("删除参赛团队成功！",2e3);var t=a.raceTeam.id;for(var o in e.raceTeams)e.raceTeams[o].id===t&&e.raceTeams.splice(o,1)},function(){Materialize.toast("删除参赛团队失败！",2e3)})},t.prototype_get_materials({id:o.id},function(t){e.materialList=t},function(){Materialize.toast("获取资料列表失败！",6e3)}),e.deleteMaterial=function(){var a=this;t.prototype_destroyById_materials({id:o.id,fk:a.materialSingle.id},function(){Materialize.toast("删除资料成功！",2e3);var t=a.materialSingle.id;for(var o in e.materialList)e.materialList[o].id===t&&e.materialList.splice(o,1)},function(){Materialize.toast("删除资料失败！",2e3)})},e.changeOpen=function(){var e=this;t.prototype_updateById_materials({id:o.id,fk:e.materialSingle.id},{open:e.materialSingle.open},function(){Materialize.toast("更改权限成功！",2e3)},function(){Materialize.toast("更改权限失败！",2e3)})}}]);
app.controller("FormListCtrl",["$scope","Team","$rootScope",function(t,o,e){e.logoHide=!1,t.showType=0,o.prototype_get_forms({id:localStorage.$LoopBack$currentTeamId,filter:{order:"updated DESC"}},function(o){t.formItems=o,t.isActivity=function(o){return 0===t.showType?t.formItems[o].activityId:!t.formItems[o].activityId}},function(){Materialize.toast("获取表单列表失败！",6e3)}),t.deleteForm=function(){var e=this;o.prototype_destroyById_forms({id:localStorage.$LoopBack$currentTeamId,fk:e.formItem.id},function(){Materialize.toast("删除成功！",2e3);var o=e.formItem.id;for(var n in t.formItems)t.formItems[n].id===o&&t.formItems.splice(n,1)},function(){Materialize.toast("删除失败！",2e3)})}}]),app.controller("FormEditCtrl",["$scope","$location","Team","$rootScope","$stateParams",function(t,o,e,n,i){n.logoHide=!0,t.isEdit=!1,""!==i.id&&(t.isEdit=!0,e.prototype_findById_forms({id:localStorage.$LoopBack$currentTeamId,fk:i.id},function(o){console.log(o),t.uploadData.title=o.title,t.forms=o._formItems})),t.forms=[],t.formType=function(t){switch(t){case"text":return"简答题";case"select":return"选择题";case"textarea":return"陈述题";case"radio":return"判断题"}},t.addForm={choice:function(){t.forms.push({type:"select",name:"",options:["A-","B-","C-","D-"]})},simple:function(){t.forms.push({type:"text",name:"",options:[]})},complex:function(){t.forms.push({type:"textarea",name:"",options:[]})},judge:function(){t.forms.push({type:"radio",name:"",options:["是","否"]})},name:function(){t.forms.push({type:"text",name:"姓名",options:[]})},sex:function(){t.forms.push({type:"select",name:"性别",options:["男","女"]})},personalID:function(){t.forms.push({type:"text",name:"身份证号",options:[]})},hometown:function(){t.forms.push({type:"text",name:"籍贯",options:[]})},studentID:function(){t.forms.push({type:"text",name:"学号",options:[]})},school:function(){t.forms.push({type:"select",name:"学院",options:["机械工程学院","电子信息学院","通信工程学院","自动化学院","计算机学院","生命信息与仪器工程学院","材料与环境工程学院","软件工程学院","理学院","经济学院","管理学院","会计学院","外国语学院","数字媒体与艺术设计学院","人文与法学院","马克思主义学院","卓越学院","信息工程学院","国际教育学院","继续教育学院"]})},major:function(){t.forms.push({type:"text",name:"专业",options:[]})},email:function(){t.forms.push({type:"text",name:"电子邮箱",options:[]})},qqNumber:function(){t.forms.push({type:"text",name:"QQ号",options:[]})},longCellphoneNumber:function(){t.forms.push({type:"text",name:"手机长号",options:[]})},shortCellphoneNumber:function(){t.forms.push({type:"text",name:"移动短号",options:[]})},introduction:function(){t.forms.push({type:"textarea",name:"个人简介",options:[]})},specials:function(){t.forms.push({type:"textarea",name:"特长",options:[]})}},t.removeForm=function(o){t.forms.splice(o,1)},t.moveUpForm=function(){this.$index>0&&t.forms.splice(this.$index-1,0,t.forms.splice(this.$index,1)[0])},t.moveDownForm=function(){this.$index<t.forms.length&&t.forms.splice(this.$index+1,0,t.forms.splice(this.$index,1)[0])},t.appendContent=function(){t.forms[this.$parent.$parent.$index].options.push("")},t.removeContent=function(){t.forms[this.$parent.$parent.$parent.$index].options.splice(this.$index,1)},t.previewForm=function(){},t.uploadData={teamId:localStorage.$LoopBack$currentTeamId},t.uploadForm=function(){for(x in t.forms)t.forms[x].id=parseInt(x);t.uploadData.updated=new Date,t.uploadData._formItems=t.forms,0===t.forms.length?Materialize.toast("请至少添加一个表单项！",1e3):t.uploadData.title?t.isEdit?e.prototype_updateById_forms({id:localStorage.$LoopBack$currentTeamId,fk:i.id},t.uploadData,function(){Materialize.toast("修改成功！请在表单模板里查看",2e3),o.path("/MS/form/list")},function(){Materialize.toast("修改失败！",2e3)}):e.prototype_create_forms({id:localStorage.$LoopBack$currentTeamId},t.uploadData,function(){Materialize.toast("创建成功！请在表单模板里查看",2e3),o.path("/MS/form/list")},function(){Materialize.toast("创建失败！",2e3)}):Materialize.toast("请填写表单名称！",1e3)}}]),app.controller("FormResultCtrl",["$scope",function(t){}]);
app.controller("HelpCtrl",["$scope","$rootScope",function(o,e){e.logoHide=!1}]);
function AdminCtrl(e,t,i,a,o){a.logoHide=!1,localStorage.$LoopBack$currentUserId&&"/MS/login"===window.location.pathname&&(window.location.pathname="/MS/home"),localStorage.$LoopBack$currentUserId?a.access=!0:(e.navShow={"padding-left":0},e.footerShow={"margin-left":0}),document.getElementById("main").style.minHeight=document.body.clientHeight-document.getElementById("footer").offsetHeight-document.getElementById("nav").offsetHeight-30+"px",e.$on("$viewContentLoaded",function(){t(function(){"/MS/home"===i.location.pathname?e.redirect(0):"/MS/member"===i.location.pathname?e.redirect(1):"/MS/event/list"===i.location.pathname||"/MS/event/edit"===i.location.pathname.substr(0,14)||"/MS/event/detail"===i.location.pathname.substr(0,16)?e.redirect(2):"/MS/activity/list"===i.location.pathname||"/MS/activity/edit"===i.location.pathname.substr(0,17)?e.redirect(3):"/MS/form/list"===i.location.pathname||"/MS/form/edit"===i.location.pathname.substr(0,13)?e.redirect(4):"/MS/vote/list"===i.location.pathname||"/MS/vote/edit"===i.location.pathname.substr(0,13)?e.redirect(5):"/MS/seckill/list"===i.location.pathname||"/MS/seckill/edit"===i.location.pathname.substr(0,16)?e.redirect(6):"/MS/album"===i.location.pathname?e.redirect(7):"/MS/setting"===i.location.pathname?e.redirect(8):"/MS/help"===i.location.pathname&&e.redirect(9)},0)}),e.sidebars=[{id:"sidebarHome",display_name:"首页",url:"/MS/home"},{id:"sidebarMember",display_name:"成员管理",url:"/MS/member"},{id:"sidebarEvent",display_name:"竞赛管理",url:"/MS/event/list"},{id:"sidebarActivity",display_name:"活动管理",url:"/MS/activity/list"},{id:"sidebarForm",display_name:"表单管理",url:"/MS/form/list"},{id:"sidebarVote",display_name:"投票管理",url:"/MS/vote/list"},{id:"sidebarSeckill",display_name:"抢票管理",url:"/MS/seckill/list"},{id:"sidebarAlbum",display_name:"相册管理",url:"/MS/album"},{id:"sidebarSetting",display_name:"设置",url:"/MS/setting"},{id:"sidebarHelp",display_name:"帮助",url:"/MS/help"}],e.redirect=function(t){for(var i=0;i<e.sidebars.length;i++)e.sidebars[i].active=!1;e.sidebars[t].active=!0,$(".button-collapse").sideNav("hide")},o.findById({id:localStorage.$LoopBack$currentTeamId},function(e){a.teamInfo=e})}app.controller("AdminCtrl",["$scope","$timeout","$window","$rootScope","Team",AdminCtrl]),app.controller("HomeCtrl",["$scope",function(e){e.logoHide=!1}]);
app.controller("MemberCtrl",["$scope","Team","$rootScope",function(e,t,r){function o(){e.memberLength=0,e.members.forEach(function(t){t.verified===!0&&(e.memberLength=e.memberLength+1)})}r.logoHide=!1,t.prototype_get_members({id:localStorage.$LoopBack$currentTeamId},function(t){e.members=t,o()},function(){Materialize.toast("获取成员列表失败！",6e3)}),e.isShowMemberDetail=!1,e.showMemberDetail=function(){e.isShowMemberDetail=!e.isShowMemberDetail},e.agreeMemberIn=function(r){t.prototype_updateById_members({id:localStorage.$LoopBack$currentTeamId,fk:r},{verified:!0},function(){Materialize.toast("已经同意申请",2e3),e.members.forEach(function(e){e.id===r&&(e.verified=!0)}),o()},function(){Materialize.toast("操作失败！",2e3)})},e.refuseMemberIn=function(r){t.prototype_destroyById_members({id:localStorage.$LoopBack$currentTeamId,fk:r},function(){Materialize.toast("已经拒绝申请",2e3);for(var t in e.members)e.members[t].id===r&&(e.members[t]=void 0)},function(){Materialize.toast("操作失败！",2e3)})},e.deleteMember=function(){var r=this;t.prototype_destroyById_members({id:localStorage.$LoopBack$currentTeamId,fk:r.member.id},function(){Materialize.toast("删除成功！",2e3);var t=r.member.id;for(var i in e.members)e.members[i].id===t&&e.members.splice(i,1);o()},function(){Materialize.toast("删除失败！",2e3)})}}]);
app.controller("SeckillListCtrl",["$scope","Team","$rootScope",function(e,t,i){i.logoHide=!1,e.showType=0,t.prototype_get_seckills({id:localStorage.$LoopBack$currentTeamId,filter:{order:"updated DESC"}},function(t){e.seckillItems=t,e.isActivity=function(t){return 0===e.showType?e.seckillItems[t].activityId:!e.seckillItems[t].activityId}},function(){Materialize.toast("获取抢票列表失败！",6e3)}),e.deleteSeckill=function(){var i=this;t.prototype_destroyById_seckills({id:localStorage.$LoopBack$currentTeamId,fk:i.seckillItem.id},function(){Materialize.toast("删除成功！",2e3);var t=i.seckillItem.id;for(var l in e.seckillItems)e.seckillItems[l].id===t&&e.seckillItems.splice(l,1)},function(){Materialize.toast("删除失败！",2e3)})}}]),app.controller("SeckillEditCtrl",["$scope","$location","Team","$rootScope","$stateParams",function(e,t,i,l,a){l.logoHide=!0,e.isEdit=!1,""!==a.id&&(e.isEdit=!0,i.prototype_findById_seckills({id:localStorage.$LoopBack$currentTeamId,fk:a.id},function(t){console.log(t),e.uploadData.title=t.title,e.uploadData.limit=t.limit,e.uploadData.total=t.total,e.uploadData.started=t.started,e.seckills=t._seckillItems}));var o=new Date;e.minDate=new Date(o.getTime()).toISOString(),e.month=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],e.monthShort=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],e.weekdaysFull=["周日","周一","周二","周三","周四","周五","周六"],e.weekdaysLetter=["日","一","二","三","四","五","六"],e.today="今天",e.clear="清除",e.close="确定",e.seckills=[],e.addSeckill=function(){e.seckills.push({name:""})},e.removeSeckill=function(t){e.seckills.splice(t,1)},e.moveUpSeckill=function(){this.$index>0&&e.seckills.splice(this.$index-1,0,e.seckills.splice(this.$index,1)[0])},e.moveDownSeckill=function(){this.$index<e.seckills.length&&e.seckills.splice(this.$index+1,0,e.seckills.splice(this.$index,1)[0])},e.appendContent=function(){e.seckills[this.$parent.$parent.$index].options.push("")},e.removeContent=function(){e.seckills[this.$parent.$parent.$parent.$index].options.splice(this.$index,1)},e.uploadData={teamId:localStorage.$LoopBack$currentTeamId},e.uploadSeckill=function(){for(x in e.seckills)e.seckills[x].id=parseInt(x);e.uploadData.updated=new Date,e.uploadData._seckillItems=e.seckills,0===e.seckills.length?Materialize.toast("请至少添加一个抢票项！",1e3):e.uploadData.title?e.uploadData.limit?e.isEdit?i.prototype_updateById_seckills({id:localStorage.$LoopBack$currentTeamId,fk:a.id},e.uploadData,function(){Materialize.toast("更新成功！请在抢票模板里查看",2e3),t.path("/MS/seckill/list")},function(){Materialize.toast("更新失败！",2e3)}):i.prototype_create_seckills({id:localStorage.$LoopBack$currentTeamId},e.uploadData,function(){Materialize.toast("创建成功！请在抢票模板里查看",2e3),t.path("/MS/seckill/list")},function(){Materialize.toast("创建失败！",2e3)}):Materialize.toast("请填写每人可抢票数！",1e3):Materialize.toast("请填写抢票名称！",1e3)}}]),app.controller("SeckillResultCtrl",["$scope",function(e){}]);
app.controller("SettingCtrl",["$scope","$rootScope",function(o,t){t.logoHide=!1}]);
app.controller("VoteListCtrl",["$scope","Team","$rootScope",function(t,e,o){o.logoHide=!1,t.showType=0,e.prototype_get_votes({id:localStorage.$LoopBack$currentTeamId,filter:{order:"updated DESC"}},function(e){t.voteItems=e,t.isActivity=function(e){return 0===t.showType?t.voteItems[e].activityId:!t.voteItems[e].activityId}},function(){Materialize.toast("获取投票列表失败！",6e3)}),t.deleteVote=function(){var o=this;e.prototype_destroyById_votes({id:localStorage.$LoopBack$currentTeamId,fk:o.voteItem.id},function(){Materialize.toast("删除成功！",2e3);var e=o.voteItem.id;for(var a in t.voteItems)t.voteItems[a].id===e&&t.voteItems.splice(a,1)},function(){Materialize.toast("删除失败！",2e3)})}}]),app.controller("VoteEditCtrl",["$scope","$location","Team","$rootScope","$stateParams",function(t,e,o,a,i){a.logoHide=!0,t.isEdit=!1,""!==i.id&&(t.isEdit=!0,o.prototype_findById_votes({id:localStorage.$LoopBack$currentTeamId,fk:i.id},function(e){console.log(e),t.uploadData.title=e.title,t.uploadData.max=e.max,t.uploadData.limit=e.limit,t.uploadData.cycle=e.cycle,t.votes=e._voteItems})),t.votes=[],t.addVote=function(){t.votes.push({name:""})},t.removeVote=function(e){t.votes.splice(e,1)},t.moveUpVote=function(){this.$index>0&&t.votes.splice(this.$index-1,0,t.votes.splice(this.$index,1)[0])},t.moveDownVote=function(){this.$index<t.votes.length&&t.votes.splice(this.$index+1,0,t.votes.splice(this.$index,1)[0])},t.appendContent=function(){t.votes[this.$parent.$parent.$index].options.push("")},t.removeContent=function(){t.votes[this.$parent.$parent.$parent.$index].options.splice(this.$index,1)},t.uploadData={teamId:localStorage.$LoopBack$currentTeamId},t.uploadVote=function(){for(x in t.votes)t.votes[x].id=parseInt(x);t.uploadData.updated=new Date,t.uploadData._voteItems=t.votes,0===t.votes.length?Materialize.toast("请至少添加一个投票项！",1e3):t.uploadData.title?t.uploadData.max||t.uploadData.limit?t.isEdit?o.prototype_updateById_votes({id:localStorage.$LoopBack$currentTeamId,fk:i.id},t.uploadData,function(){Materialize.toast("修改成功！请在投票模板里查看",2e3),e.path("/MS/vote/list")},function(){Materialize.toast("修改失败！",2e3)}):o.prototype_create_votes({id:localStorage.$LoopBack$currentTeamId},t.uploadData,function(){Materialize.toast("创建成功！请在投票模板里查看",2e3),e.path("/MS/vote/list")},function(){Materialize.toast("创建失败！",2e3)}):Materialize.toast("请填写投票票数限制！",1e3):Materialize.toast("请填写投票名称！",1e3)}}]),app.controller("VoteResultCtrl",["$scope",function(t){}]);