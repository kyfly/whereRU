app.controller("ActivityListCtrl",["$scope","Team","$rootScope",function(t,e,a){a.pageTitle="活动列表",t.chosenType="",t.unFormat="yyyy-MM-dd HH:mm",t.format="yyyy-MM-dd",e.prototype_get_activities({id:localStorage.$LoopBack$currentTeamId,filter:{where:{deleted:!1},order:"created DESC"}},function(e){t.activityItems=e},function(){Materialize.toast("获取活动列表失败！",6e3)}),t.deleteActivity=function(){var a=this;e.prototype_updateById_activities({id:localStorage.$LoopBack$currentTeamId,fk:a.activityItem.id},{deleted:!0},function(){Materialize.toast("删除成功！",2e3);var e=a.activityItem.id;for(var i in t.activityItems)t.activityItems[i].id===e&&t.activityItems.splice(i,1)},function(){Materialize.toast("删除失败！",2e3)})}}]),app.controller("ActivityEditCtrl",["$scope","Team","Ueditor","$location","$http","Activity","$stateParams","uploadFile","$timeout","$rootScope",function(t,e,a,i,o,r,d,c,n,l){var m=new Date;t.minDate=new Date(m.getTime()).toISOString(),t.month=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],t.monthShort=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],t.weekdaysFull=["周日","周一","周二","周三","周四","周五","周六"],t.weekdaysLetter=["日","一","二","三","四","五","六"],t.today="今天",t.clear="清除",t.close="确定",t.activityEditorConfig=a.config,t.activityData={authorName:t.teamInfo.name,authorId:t.teamInfo.id,type:t.teamInfo.type,school:t.teamInfo.school,created:new Date},t.startTime={},t.endTime={};var s=["mainInfo","copywriter","complete"];t.isEdit=d.id||!1,l.pageTitle=t.isEdit?"编辑活动":"新建活动",t.picNotice=t.isEdit?"如果要更换图片请上传,建议900*500像素":"请上传活动封面,建议900*500像素",t.preType={},d.id&&e.prototype_findById_activities({id:t.teamInfo.id,fk:d.id},function(e){t.activityData=e,t.activityEditorContent=e.explain;var a=new Date(e.started),i=new Date(e.ended);t.startTime.date=a,t.startTime.hour=a.getHours(),t.startTime.minute=a.getMinutes(),t.endTime.date=i,t.endTime.hour=i.getHours(),t.endTime.minute=i.getMinutes(),"common"!==e.actType&&(t.preType.type=e.actType,r["prototype_get_"+e.actType+"s"]({id:d.id},function(a){a[0]&&(t[e.actType+"Data"]=a[0],t.preType.id=a[0].id)}))}),t.hourChange=function(e){0===e?(t.startTime.hour>23?t.startTime.hour=23:t.startTime.hour<0&&(t.startTime.hour=0),t.startTime.hour=parseInt(t.startTime.hour)):(t.endTime.hour>23?t.endTime.hour=23:t.endTime.hour<0&&(t.endTime.hour=0),t.endTime.hour=parseInt(t.endTime.hour))},t.minuteChange=function(e){0===e?(t.startTime.minute>59?t.startTime.minute=59:t.startTime.minute<0&&(t.startTime.minute=0),t.startTime.minute=parseInt(t.startTime.minute)):(t.endTime.minute>59?t.endTime.minute=59:t.endTime.minute<0&&(t.endTime.minute=0),t.endTime.minute=parseInt(t.endTime.minute))},t.nextStep=function(t){$("#editActivityTabs").tabs("select_tab",s[t])},t.activityImgLoad=function(){var e=document.getElementById("activityImg").files[0],a=(new XMLHttpRequest,/\.[^\.]+/.exec(document.getElementById("activityImg").value.toLowerCase()));return".png"!==a[0]&&".jpg"!==a[0]&&".jpeg"!==a[0]&&".gif"!==a[0]?(alert("请确认您上传的logo文件格式是jpg、png、gif或jpeg"),!1):void c.img(e,"team",t.teamInfo.id).success(function(e){t.activityData.imgUrl=e.url})},t.getActivityList=function(a){e["prototype_get_"+a+"s"]({id:t.teamInfo.id},function(e){t[a+"Items"]=e.filter(function(t){return!(t.activityId||t.noticeId)})})},t.addFormFunc=function(){t.formData=this.formItem,$("#addForm").closeModal()},t.addVoteFunc=function(){t.voteData=this.voteItem,$("#addVote").closeModal()},t.addSeckillFunc=function(){return t.seckillData=this.seckillItem,t.seckillData.started<t.activityData.started?void Materialize.toast("抢票开始时间怎么能在活动开始前呢，记得修改噢",4e3):void $("#addSeckill").closeModal()},t.removeFormData=function(){t.formData=void 0},t.removeVoteData=function(){t.voteData=void 0},t.removeSeckillData=function(){t.seckillData=void 0},t.createActivity=function(){var a=new Date(t.startTime.date);a.setHours(t.startTime.hour),a.setMinutes(t.startTime.minute),a.setSeconds(0),t.activityData.started=a;var o=new Date(t.endTime.date);return o.setHours(t.endTime.hour),o.setMinutes(t.endTime.minute),o.setSeconds(0),t.activityData.ended=o,t.activityData.ended<t.activityData.started?void Materialize.toast("结束时间怎么能比开始时间早呢",4e3):(t.seckillData&&t.seckillData.started<t.activityData.started&&Materialize.toast("抢票开始时间在活动开始前，记得修改噢",4e3),void c.text(t.activityEditorContent,"team",t.teamInfo.id).success(function(a){t.activityData.explainUrl=a.url,t.activityData.team=void 0,t.formData?t.activityData.actType="form":t.voteData?t.activityData.actType="vote":t.seckillData?t.activityData.actType="seckill":t.activityData.actType="common",d.id?e.prototype_updateById_activities({id:localStorage.$LoopBack$currentTeamId,fk:d.id},t.activityData,function(e){Materialize.toast("更新成功！",2e3),t.formData?(t.formData.updated=new Date,t.formData.id=void 0,t.formData.title=t.activityData.title,t.formData.activityId=d.id,t.formData.teamId=localStorage.$LoopBack$currentTeamId,"form"===t.preType.type?r.prototype_updateById_forms({id:e.id,fk:t.preType.id},t.formData):r.prototype_create_forms({id:e.id},t.formData)):"form"===t.preType.type&&r.prototype_delete_forms({id:e.id}),t.voteData?(t.voteData.updated=new Date,t.voteData.id=void 0,t.voteData.activityId=d.id,t.voteData.teamId=localStorage.$LoopBack$currentTeamId,t.voteData.title=t.activityData.title,"vote"===t.preType.type?r.prototype_updateById_votes({id:e.id,fk:t.preType.id},t.voteData):r.prototype_create_votes({id:e.id},t.voteData)):"vote"===t.preType.type&&r.prototype_delete_votes({id:e.id}),t.seckillData?(t.seckillData.updated=new Date,t.seckillData.id=void 0,t.seckillData.activityId=d.id,t.seckillData.teamId=localStorage.$LoopBack$currentTeamId,t.seckillData.title=t.activityData.title,"seckill"===t.preType.type?r.prototype_updateById_seckills({id:e.id,fk:t.preType.id},t.seckillData):r.prototype_create_seckills({id:e.id},t.seckillData)):"seckill"===t.preType.type&&r.prototype_delete_seckills({id:e.id}),i.path("/MS/activity/list")},function(){Materialize.toast("更新失败！",2e3)}):e.prototype_create_activities({id:localStorage.$LoopBack$currentTeamId},t.activityData,function(e){Materialize.toast("创建成功！",2e3),t.formData?(t.formData.updated=new Date,t.formData.activityId=e.id,t.formData.id=void 0,t.formData.teamId=localStorage.$LoopBack$currentTeamId,t.formData.title=t.activityData.title,r.prototype_create_forms({id:e.id},t.formData)):t.voteData?(t.voteData.updated=new Date,t.voteData.activityId=e.id,t.voteData.id=void 0,t.voteData.teamId=localStorage.$LoopBack$currentTeamId,t.voteData.title=t.activityData.title,r.prototype_create_votes({id:e.id},t.voteData)):t.seckillData&&(t.seckillData.updated=new Date,t.seckillData.activityId=e.id,t.seckillData.id=void 0,t.seckillData.title=t.activityData.title,t.seckillData.teamId=localStorage.$LoopBack$currentTeamId,r.prototype_create_seckills({id:e.id},t.seckillData)),i.path("/MS/activity/list")},function(){Materialize.toast("创建失败！请不要漏填信息哦！",2e3)})}).error(function(){Materialize.toast("别忘了写活动文案哦！",2e3)}))}}]);
app.controller("AlbumCtrl",["$scope","$rootScope",function(o,l){l.logoHide=!1}]);
app.controller("EventListCtrl",["$scope","Team","$rootScope","Race",function(e,t,a,i){a.pageTitle="竞赛列表",e.unFormat="yyyy-MM-dd HH:mm",e.format="yyyy-MM-dd",t.prototype_get_races({id:e.teamInfo.id,filter:{where:{deleted:!1},order:"created DESC"}},function(t){e.eventItems=t},function(){Materialize.toast("获取创建竞赛列表失败！",6e3)}),t.prototype_get_partakedRaces({id:e.teamInfo.id,filter:{order:"created DESC"}},function(t){e.partakedEventItems=t},function(){Materialize.toast("获取参与竞赛列表失败！",2e3)});var n=new Date+2592e3;i.find({filter:{where:{or:[{started:{lt:n}},{ended:{gt:new Date}}],school:e.teamInfo.school}}},function(t){e.recommendRaces=t}),e.deleteEvent=function(){var a=this;t.prototype_updateById_races({id:e.teamInfo.id,fk:a.eventItem.id},{deleted:!0,updated:new Date},function(){Materialize.toast("删除成功！",2e3),delete a.eventItem},function(){Materialize.toast("删除失败！",2e3)})},e.quitEvent=function(){var e=this;t.prototype_unlink_partakedRaces({id:localStorage.$LoopBack$currentTeamId,fk:e.partakedEventItem.id},function(){Materialize.toast("删除成功！",2e3),delete e.partakedEventItem},function(){Materialize.toast("删除失败！",2e3)})},e.joinRace=function(){t.prototype_link_partakedRaces({id:e.teamInfo.id,fk:this.race.id},{},function(e){Materialize.toast("参与成功,刷新后可在参与列表查看",2e3)})}}]),app.controller("EventEditCtrl",["$scope","Team","Ueditor","$http","$location","uploadFile","$stateParams","$rootScope",function(e,t,a,i,n,o,r,d){e.eventData={authorName:e.teamInfo.name,authorId:e.teamInfo.id,school:e.teamInfo.school},e.startTime={},e.endTime={},e.isEdit=r.id||!1,d.pageTitle=e.isEdit?"编辑竞赛":"新建竞赛",e.picNotice=e.isEdit?"如果要更换图片请上传,建议900*500像素":"请上传活动封面,建议900*500像素",e.isEdit&&t.prototype_findById_races({id:e.teamInfo.id,fk:r.id},function(t){e.eventData=t,e.eventEditorContent=t.explain;var a=new Date(t.started),i=new Date(t.ended);e.startTime.date=a,e.startTime.hour=a.getHours(),e.startTime.minute=a.getMinutes(),e.endTime.date=i,e.endTime.hour=i.getHours(),e.endTime.minute=i.getMinutes()}),e.hourChange=function(t){0===t?(e.startTime.hour>23?e.startTime.hour=23:e.startTime.hour<0&&(e.startTime.hour=0),e.startTime.hour=parseInt(e.startTime.hour)):(e.endTime.hour>23?e.endTime.hour=23:e.endTime.hour<0&&(e.endTime.hour=0),e.endTime.hour=parseInt(e.endTime.hour))},e.minuteChange=function(t){0===t?(e.startTime.minute>59?e.startTime.minute=59:e.startTime.minute<0&&(e.startTime.minute=0),e.startTime.minute=parseInt(e.startTime.minute)):(e.endTime.minute>59?e.endTime.minute=59:e.endTime.minute<0&&(e.endTime.minute=0),e.endTime.minute=parseInt(e.endTime.minute))};var c=new Date;e.minDate=new Date(c.getTime()).toISOString(),e.month=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],e.monthShort=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],e.weekdaysFull=["周日","周一","周二","周三","周四","周五","周六"],e.weekdaysLetter=["日","一","二","三","四","五","六"],e.today="今天",e.clear="清除",e.close="确定";var m=["mainInfo","copywriter","complete"];e.nextStep=function(e){$("#editEventTabs").tabs("select_tab",m[e])},e.eventImgLoad=function(){var t=document.getElementById("eventImg").files[0],a=/\.[^\.]+/.exec(document.getElementById("eventImg").value.toLowerCase());return".png"!==a[0]&&".jpg"!==a[0]&&".jpeg"!==a[0]&&".gif"!==a[0]?(alert("请确认您上传的logo文件格式是jpg、png、gif或jpeg"),!1):void o.img(t,"team",e.teamInfo.id).success(function(t){e.eventData.imgUrl=t.url})},e.eventEditorConfig=a.config,e.createEvent=function(){var a=new Date(e.startTime.date);a.setHours(e.startTime.hour),a.setMinutes(e.startTime.minute),a.setSeconds(0),e.eventData.started=a;var i=new Date(e.endTime.date);i.setHours(e.endTime.hour),i.setMinutes(e.endTime.minute),i.setSeconds(0),e.eventData.ended=i,o.text(e.eventEditorContent,"team",e.teamInfo.id).success(function(a){e.eventData.explainUrl=a.url,e.eventData.created=new Date,e.eventData.deleted=!1,r.id?t.prototype_updateById_races({id:e.teamInfo.id,fk:r.id},e.eventData,function(){Materialize.toast("更新成功！",2e3),n.path("/MS/event/list")},function(){Materialize.toast("更新失败！",2e3)}):t.prototype_create_races({id:e.teamInfo.id},e.eventData,function(){Materialize.toast("创建成功！",2e3),n.path("/MS/event/list")},function(){Materialize.toast("创建失败！请不要漏填信息哦！",2e3)})}).error(function(){Materialize.toast("别忘了写竞赛介绍哦！",2e3)})}}]),app.controller("EventDetailCtrl",["$scope","Race","$http","$stateParams","uploadFile","Team","Notice","User","$rootScope",function(e,t,a,i,n,o,r,d,c){c.pageTitle="竞赛详情",e.isAuthor="author"===i.type,e.uploadAttachmentBtn=!1,e.addGetInfoBtn=!1,e.addNoticeForm=!1,e.submitResult=!1,e.newNotice={},e.materialInfo={loader:e.teamInfo.name,open:!0},t.findById({id:i.id},function(t){e.raceInfo=t}),e.materialLoad=function(){var t=document.getElementById("addMaterialDoc").files[0];n.file(t,"team",e.teamInfo.id).success(function(t){e.materialInfo.dataUrl=t.url}).error()},e.getActivityList=function(t){o["prototype_get_"+t+"s"]({id:e.teamInfo.id},function(a){e[t+"Items"]=a.filter(function(e){return!(e.activityId||e.noticeId)})})},e.addFormFunc=function(){e.formData=this.formItem,$("#addForm").closeModal()},e.removeFormData=function(){e.formData=void 0},e.createMaterial=function(){e.materialInfo.created=new Date,e.materialInfo.name?t.prototype_create_materials({id:i.id},e.materialInfo,function(t){Materialize.toast("上传成功！",2e3),e.materialInfo=void 0,e.materialList.push(t)},function(){Materialize.toast("上传失败！",2e3)}):Materialize.toast("请先选择一个文件哦！",2e3)},t.prototype_get_notices({id:i.id},function(t){e.noticeList=t},function(){Materialize.toast("获取通知列表失败！",2e3)}),e.deleteNotice=function(){var e=this;t.prototype_updateById_notices({id:i.id,fk:e.notice.id},{deleted:!0},function(){Materialize.toast("删除成功！",2e3),delete e.notice},function(){Materialize.toast("删除失败！",2e3)})},e.uploadAttachment=function(){var t=document.getElementById("attachmentFile").files[0];n.file(t,"team",e.teamInfo.id).success(function(t){e.newNotice.attachmentUrl=t.url}).error()},e.createNotice=function(){e.newNotice.created=new Date,e.newNotice.content?t.prototype_create_notices({id:i.id},e.newNotice,function(t){Materialize.toast("创建成功！",2e3),e.newNotice=void 0,e.formData&&(e.formData.updated=new Date,e.formData.noticeId=t.id,e.formData.id=void 0,e.formData.teamId=localStorage.$LoopBack$currentTeamId,t.form=e.formData,r.prototype_create_form({id:t.id},e.formData),e.formData=void 0),e.noticeList.push(t)},function(){Materialize.toast("创建失败！",2e3)}):Materialize.toast("请先填写通知内容哦",2e3)},e.uploadNoticeFile=function(){var t=document.getElementById(this.notice.id).files[0],a=this.notice;n.file(t,"team",e.teamInfo.id).success(function(t){a.dataUrl=t.url,e.putFileInfo(a)}).error()},e.putFileInfo=function(a){t.prototype_updateById_notices({id:i.id,fk:a.id},{name:a.file,dataUrl:a.dataUrl,created:new Date,loader:e.teamInfo.name,teamId:e.teamInfo.id},function(e){Materialize.toast("资料上传成功！",2e3)},function(e){Materialize.toast(e.data.error.message,2e3)})},e.initFormResult=function(){this.notice.showForm=!this.notice.showForm,this.notice.form._formItems.forEach(function(e){e.result=void 0})},e.submitResult=function(){var e=[],t={};this.notice.form._formItems.forEach(function(t){e.push({name:t.result,type:t.type})}),t.formId=this.notice.form.id,t.created=new Date,t.result=e,d.prototype_create_formResults({id:localStorage.$LoopBack$currentUserId},t,function(e){1e3===e.status||1100===e.status?Materialize.toast(e.message,2e3):Materialize.toast("表单提交成功",2e3)},function(e){})},t.prototype_get_raceTeams({id:i.id},function(t){e.raceTeams=t}),e.deleteRaceTeam=function(){var e=this;t.prototype_unlink_raceTeams({id:i.id,fk:e.raceTeam.id},function(){Materialize.toast("删除参赛团队成功！",2e3),delete e.raceTeam},function(){Materialize.toast("删除参赛团队失败！",2e3)})},t.prototype_get_materials({id:i.id},function(t){e.materialList=t},function(){Materialize.toast("获取资料列表失败！",6e3)}),e.deleteMaterial=function(){var e=this;t.prototype_destroyById_materials({id:i.id,fk:e.materialSingle.id},function(){Materialize.toast("删除资料成功！",2e3),delete e.materialSingle},function(){Materialize.toast("删除资料失败！",2e3)})},e.changeOpen=function(){var e=this;t.prototype_updateById_materials({id:i.id,fk:e.materialSingle.id},{open:e.materialSingle.open},function(){Materialize.toast("更改权限成功！",2e3)},function(){Materialize.toast("更改权限失败！",2e3)})}}]);
app.controller("FormListCtrl",["$scope","Team","$rootScope",function(t,e,o){o.pageTitle="表单列表",t.showType=0,e.prototype_get_forms({id:localStorage.$LoopBack$currentTeamId,filter:{order:"updated DESC"}},function(e){t.formItems=e,t.isActivity=function(e){return 0===t.showType?t.formItems[e].activityId||t.formItems[e].noticeId:!(t.formItems[e].activityId||t.formItems[e].noticeId)}},function(){Materialize.toast("获取表单列表失败！",6e3)}),t.deleteForm=function(){var o=this;e.prototype_destroyById_forms({id:localStorage.$LoopBack$currentTeamId,fk:o.formItem.id},function(){Materialize.toast("删除成功！",2e3);var e=o.formItem.id;for(var n in t.formItems)t.formItems[n].id===e&&t.formItems.splice(n,1)},function(){Materialize.toast("删除失败！",2e3)})}}]),app.controller("FormEditCtrl",["$scope","$location","Team","$rootScope","$stateParams",function(t,e,o,n,i){n.pageTitle="",t.isEdit=!1,""!==i.id?(t.isEdit=!0,o.prototype_findById_forms({id:localStorage.$LoopBack$currentTeamId,fk:i.id},function(e){t.uploadData=e,t.forms=e._formItems})):(t.forms=[],t.uploadData={teamId:localStorage.$LoopBack$currentTeamId}),t.formType=function(t){switch(t){case"text":return"简答题";case"select":return"选择题";case"textarea":return"陈述题";case"radio":return"判断题"}},t.addForm={choice:function(){t.forms.push({type:"select",name:"",options:["A-","B-","C-","D-"]})},simple:function(){t.forms.push({type:"text",name:"",options:[]})},complex:function(){t.forms.push({type:"textarea",name:"",options:[]})},judge:function(){t.forms.push({type:"radio",name:""})},file:function(){t.forms.push({type:"file",name:"",options:[]})},name:function(){t.forms.push({type:"text",name:"姓名",len:5,options:[]})},sex:function(){t.forms.push({type:"select",name:"性别",options:["男","女"]})},personalID:function(){t.forms.push({type:"text",name:"身份证号",len:18,options:[]})},hometown:function(){t.forms.push({type:"text",name:"籍贯",len:10,options:[]})},studentID:function(){t.forms.push({type:"text",name:"学号",len:8,options:[]})},school:function(){t.forms.push({type:"select",name:"学院",options:["机械工程学院","电子信息学院","通信工程学院","自动化学院","计算机学院","生命信息与仪器工程学院","材料与环境工程学院","软件工程学院","理学院","经济学院","管理学院","会计学院","外国语学院","数字媒体与艺术设计学院","人文与法学院","马克思主义学院","卓越学院","信息工程学院","国际教育学院","继续教育学院"]})},major:function(){t.forms.push({type:"text",name:"专业",len:20,options:[]})},email:function(){t.forms.push({type:"text",name:"电子邮箱",len:30,options:[]})},qqNumber:function(){t.forms.push({type:"text",name:"QQ号",len:15,options:[]})},longCellphoneNumber:function(){t.forms.push({type:"text",name:"手机长号",len:11,options:[]})},shortCellphoneNumber:function(){t.forms.push({type:"text",name:"移动短号",len:6,options:[]})},introduction:function(){t.forms.push({type:"textarea",name:"个人简介",len:200,options:[]})},specials:function(){t.forms.push({type:"textarea",name:"特长",len:100,options:[]})}},t.removeForm=function(e){t.forms.splice(e,1)},t.moveUpForm=function(){this.$index>0&&t.forms.splice(this.$index-1,0,t.forms.splice(this.$index,1)[0])},t.moveDownForm=function(){this.$index<t.forms.length&&t.forms.splice(this.$index+1,0,t.forms.splice(this.$index,1)[0])},t.appendContent=function(){t.forms[this.$parent.$parent.$index].options.push("")},t.removeContent=function(){t.forms[this.$parent.$parent.$parent.$index].options.splice(this.$index,1)},t.previewForm=function(){},t.uploadForm=function(){for(x in t.forms)t.forms[x].id=parseInt(x);t.uploadData.updated=new Date,t.uploadData._formItems=t.forms,0===t.forms.length?Materialize.toast("请至少添加一个表单项！",1e3):t.uploadData.title?t.isEdit?o.prototype_updateById_forms({id:localStorage.$LoopBack$currentTeamId,fk:i.id},t.uploadData,function(){Materialize.toast("修改成功！请在表单模板里查看",2e3),e.path("/MS/form/list")},function(t){Materialize.toast(t.data.error.message||"更新失败",2e3)}):o.prototype_create_forms({id:localStorage.$LoopBack$currentTeamId},t.uploadData,function(){Materialize.toast("创建成功！请在表单模板里查看",2e3),e.path("/MS/form/list")},function(t){Materialize.toast(t.data.error.message||"创建失败",2e3)}):Materialize.toast("请填写表单名称！",1e3)}}]),app.controller("FormResultCtrl",["$scope","$rootScope","$stateParams","Form","Team","$location",function(t,e,o,n,i,a){i.prototype_findById_forms({id:localStorage.$LoopBack$currentTeamId,fk:o.id},function(o){e.pageTitle="表单["+o.title+"]结果",t.form=o,t.url="http://"+a.host()+":"+a.port()+"/api/Forms/"+t.form.id+"/excel?access_token="+t.accesstoken}),n.prototype_get_formResults({id:o.id},function(e){t.results=e});var r="active";t.pageViewActive=r,t.pageView=function(){t.pageViewActive=r,t.allViewActive=!1},t.allViewActive=!1,t.allView=function(){t.pageViewActive=!1,t.allViewActive=r}}]);
app.controller("HelpCtrl",["$scope","$rootScope",function(o,e){e.logoHide=!1}]);
function AdminCtrl(e,i,a,l,d){l.pageTitle="首页",e.$on("$stateChangeStart",function(i,a,l){"index"!==a.name&&e.redirect(a.stateIndex)}),e.sidebars=[{id:"sidebarHome",display_name:"首页",url:"/"},{id:"sidebarMember",display_name:"成员管理",url:"/MS/member"},{id:"sidebarEvent",display_name:"竞赛管理",url:"/MS/event/list"},{id:"sidebarActivity",display_name:"活动管理",url:"/MS/activity/list"},{id:"sidebarForm",display_name:"表单管理",url:"/MS/form/list"},{id:"sidebarVote",display_name:"投票管理",url:"/MS/vote/list"},{id:"sidebarSeckill",display_name:"抢票管理",url:"/MS/seckill/list"},{id:"sidebarAlbum",display_name:"资料管理",url:"/MS/album"},{id:"sidebarSetting",display_name:"设置",url:"/MS/setting"},{id:"sidebarHelp",display_name:"帮助",url:"/MS/help"}],e.redirect=function(i){for(var a=0;a<e.sidebars.length;a++)e.sidebars[a].active=!1;e.sidebars[i].active=!0,$(".button-collapse").sideNav("hide")}}app.controller("AdminCtrl",["$scope","$timeout","$window","$rootScope","Team",AdminCtrl]),app.controller("HomeCtrl",["$scope",function(e){e.logoHide=!1}]);
app.controller("MemberCtrl",["$scope","Team","$rootScope",function(e,t,i){function o(){e.memberLength=0,e.members.forEach(function(t){t.verified===!0&&(e.memberLength=e.memberLength+1)})}i.pageTitle="成员管理",t.prototype_get_members({id:e.teamInfo.id},function(t){e.members=t,o()},function(){Materialize.toast("获取成员列表失败！",6e3)}),e.isShowMemberDetail=!1,e.showMemberDetail=function(){e.isShowMemberDetail=!e.isShowMemberDetail},e.agreeMemberIn=function(i){var o=this.member;t.prototype_updateById_members({id:e.teamInfo.id,fk:i},{verified:!0},function(){Materialize.toast("已经同意申请",2e3),o.verified=!0},function(){Materialize.toast("操作失败！",2e3)})},e.refuseMemberIn=function(i){var o=this;t.prototype_destroyById_members({id:e.teamInfo.id,fk:i},function(){Materialize.toast("已经拒绝申请",2e3),delete o.member},function(){Materialize.toast("操作失败！",2e3)})},e.deleteMember=function(){var i=this;t.prototype_destroyById_members({id:e.teamInfo.id,fk:this.member.id},function(){Materialize.toast("删除成功！",2e3),delete i.members[i.$index]},function(){Materialize.toast("删除失败！",2e3)})}}]);
app.controller("SeckillListCtrl",["$scope","Team","$rootScope",function(e,t,i){i.pageTitle="抢票列表",e.showType=0,t.prototype_get_seckills({id:localStorage.$LoopBack$currentTeamId,filter:{order:"updated DESC"}},function(t){e.seckillItems=t,e.isActivity=function(t){return 0===e.showType?e.seckillItems[t].activityId:!e.seckillItems[t].activityId}},function(){Materialize.toast("获取抢票列表失败！",6e3)}),e.deleteSeckill=function(){var i=this;t.prototype_destroyById_seckills({id:localStorage.$LoopBack$currentTeamId,fk:i.seckillItem.id},function(){Materialize.toast("删除成功！",2e3);var t=i.seckillItem.id;for(var a in e.seckillItems)e.seckillItems[a].id===t&&e.seckillItems.splice(a,1)},function(){Materialize.toast("删除失败！",2e3)})}}]),app.controller("SeckillEditCtrl",["$scope","$location","Team","$rootScope","$stateParams",function(e,t,i,a,l){e.startTime={},e.isEdit=!1,""!==l.id?(e.isEdit=!0,i.prototype_findById_seckills({id:localStorage.$LoopBack$currentTeamId,fk:l.id},function(t){e.uploadData=t,e.seckills=t._seckillItems;var i=new Date(t.started);e.startTime.date=i,e.startTime.hour=i.getHours(),e.startTime.minute=i.getMinutes()})):(e.seckills=[],e.uploadData={teamId:localStorage.$LoopBack$currentTeamId}),a.pageTitle=e.isEdit?"编辑抢票":"新建抢票";var s=new Date;e.minDate=new Date(s.getTime()).toISOString(),e.month=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],e.monthShort=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],e.weekdaysFull=["周日","周一","周二","周三","周四","周五","周六"],e.weekdaysLetter=["日","一","二","三","四","五","六"],e.today="今天",e.clear="清除",e.close="确定",e.hourChange=function(){e.startTime.hour>23?e.startTime.hour=23:e.startTime.hour<0&&(e.startTime.hour=0),e.startTime.hour=parseInt(e.startTime.hour)},e.minuteChange=function(){e.startTime.minute>59?e.startTime.minute=59:e.startTime.minute<0&&(e.startTime.minute=0),e.startTime.minute=parseInt(e.startTime.minute)},e.addSeckill=function(){e.seckills.push({name:""})},e.removeSeckill=function(t){e.seckills.splice(t,1)},e.moveUpSeckill=function(){this.$index>0&&e.seckills.splice(this.$index-1,0,e.seckills.splice(this.$index,1)[0])},e.moveDownSeckill=function(){this.$index<e.seckills.length&&e.seckills.splice(this.$index+1,0,e.seckills.splice(this.$index,1)[0])},e.appendContent=function(){e.seckills[this.$parent.$parent.$index].options.push("")},e.removeContent=function(){e.seckills[this.$parent.$parent.$parent.$index].options.splice(this.$index,1)},e.uploadSeckill=function(){for(x in e.seckills)e.seckills[x].id=parseInt(x);e.uploadData.updated=new Date;var a=new Date(e.startTime.date);a.setHours(e.startTime.hour),a.setMinutes(e.startTime.minute),a.setSeconds(0),e.uploadData.started=a,e.uploadData._seckillItems=e.seckills,0===e.seckills.length?Materialize.toast("请至少添加一个抢票项！",1e3):e.uploadData.title?e.isEdit?i.prototype_updateById_seckills({id:localStorage.$LoopBack$currentTeamId,fk:l.id},e.uploadData,function(){Materialize.toast("更新成功！请在抢票模板里查看",2e3),t.path("/MS/seckill/list")},function(e){Materialize.toast(e.data.error.message||"更新失败",2e3)}):i.prototype_create_seckills({id:localStorage.$LoopBack$currentTeamId},e.uploadData,function(){Materialize.toast("创建成功！请在抢票模板里查看",2e3),t.path("/MS/seckill/list")},function(e){Materialize.toast(e.data.error.message||"创建失败",2e3)}):Materialize.toast("请填写抢票名称！",1e3)}}]),app.controller("SeckillResultCtrl",["$scope","$rootScope","$stateParams","Seckill","Team",function(e,t,i,a,l){l.prototype_findById_seckills({id:localStorage.$LoopBack$currentTeamId,fk:i.id},function(i){t.pageTitle="["+i.title+"]结果",e.seckill=i}),a.prototype_get_seckillResults({id:i.id},function(t){e.results=t});var s="active";e.pageViewActive=s,e.pageView=function(){e.pageViewActive=s,e.allViewActive=!1},e.allViewActive=!1,e.allView=function(){e.pageViewActive=!1,e.allViewActive=s},e.queryInput=function(){e.query.verifyId||(e.query=void 0)},e.invoice=function(){var e=this;a.prototype_updateById_seckillResults({id:i.id,fk:this.resultItem.id},{invoiced:!0},function(t){e.resultItem.invoiced=!0})}}]);
app.controller("SettingCtrl",["$scope","$rootScope","Team","uploadFile",function(e,t,a,n){t.logoHide=!1,e.team={},a.findById({id:localStorage.$LoopBack$currentTeamId},function(t){e.team=t}),e.types=[{name:"校园组织"},{name:"校园团队"},{name:"兴趣团队"},{name:"技术团队"}],e.uploadLogo=function(){var t=document.getElementById("teamlogo").files[0];if(t){var a=/\.[^\.]+/.exec(document.getElementById("teamlogo").value.toLowerCase());return".png"!==a[0]&&".jpg"!==a[0]&&".jpeg"!==a[0]&&".gif"!==a[0]?(alert("请确认您上传的logo文件格式是jpg、png、gif或jpeg"),!1):void n.img(t,"team",e.teamInfo.id).success(function(t){e.team.logoUrl=t.url})}},e.addDepartment=function(){e.team.teamDepartments.push({name:"",desc:""})},e.moveUpDepartment=function(t){t>0&&e.team.teamDepartments.splice(t-1,0,e.team.teamDepartments.splice(t,1)[0])},e.moveDownDepartment=function(t){t<e.team.teamDepartments.length&&e.team.teamDepartments.splice(t+1,0,e.team.teamDepartments.splice(t,1)[0])},e.removeDepartment=function(t){e.team.teamDepartments.splice(t,1)},e.updateInfo=function(){e.team.updated=new Date;var t=[];if(e.team.teamDepartments.length)for(var n=0;n<e.team.teamDepartments.length;n++)t.push(e.team.teamDepartments[n]),t[n].id=n;console.log(e.team),a.prototype_updateAttributes({id:localStorage.$LoopBack$currentTeamId},e.team,function(){Materialize.toast("更新成功！",2e3)},function(){Materialize.toast("更新失败！",2e3)})}}]);
function sort(t){var e=0,o=t.length-1,i=function(e,o){if(e!=o){for(var n=t[e].count,a=e,c=o;o>e;)if(t[o].count>=n)o--;else for(t[e].count=t[o].count;o>++e;)if(t[e].count>n){t[o].count=t[e].count;break}if(a==e)return void i(++e,c);t[e].count=n,i(a,e),i(o,c)}};return i(e,o),t}function requestFullScreen(t){var e=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;if(e)e.call(t);else if("undefined"!=typeof window.ActiveXObject){var o=new ActiveXObject("WScript.Shell");null!==o&&o.SendKeys("{F11}")}}app.controller("VoteListCtrl",["$scope","Team","$rootScope",function(t,e,o){o.pageTitle="投票列表",t.showType=0,e.prototype_get_votes({id:localStorage.$LoopBack$currentTeamId,filter:{order:"updated DESC"}},function(e){t.voteItems=e,t.isActivity=function(e){return 0===t.showType?t.voteItems[e].activityId:!t.voteItems[e].activityId}},function(){Materialize.toast("获取投票列表失败！",6e3)}),t.deleteVote=function(){var o=this;e.prototype_destroyById_votes({id:localStorage.$LoopBack$currentTeamId,fk:o.voteItem.id},function(){Materialize.toast("删除成功！",2e3);var e=o.voteItem.id;for(var i in t.voteItems)t.voteItems[i].id===e&&t.voteItems.splice(i,1)},function(){Materialize.toast("删除失败！",2e3)})}}]),app.controller("VoteEditCtrl",["$scope","$location","Team","$rootScope","$stateParams","uploadFile",function(t,e,o,i,n,a){t.isEdit=!1,""!==n.id?(t.isEdit=!0,o.prototype_findById_votes({id:localStorage.$LoopBack$currentTeamId,fk:n.id},function(e){t.uploadData=e,t.votes=e._voteItems})):(t.votes=[],t.uploadData={teamId:localStorage.$LoopBack$currentTeamId}),i.pageTitle=t.isEdit?"编辑投票":"新建投票",t.addVote=function(){t.votes.push({name:""})},t.removeVote=function(e){t.votes.splice(e,1)},t.moveUpVote=function(){this.$index>0&&t.votes.splice(this.$index-1,0,t.votes.splice(this.$index,1)[0])},t.moveDownVote=function(){this.$index<t.votes.length&&t.votes.splice(this.$index+1,0,t.votes.splice(this.$index,1)[0])},t.appendContent=function(){t.votes[this.$parent.$parent.$index].options.push("")},t.removeContent=function(){t.votes[this.$parent.$parent.$parent.$index].options.splice(this.$index,1)},t.uploadImg=function(){var e=this.vote,o=document.getElementById("vote_"+this.$index).files[0];if(o){var i=/\.[^\.]+/.exec(document.getElementById("vote_"+this.$index).value.toLowerCase());return".png"!==i[0]&&".jpg"!==i[0]&&".jpeg"!==i[0]&&".gif"!==i[0]?(alert("请确认您上传的logo文件格式是jpg、png、gif或jpeg"),!1):void a.img(o,"team",t.teamInfo.id).success(function(t){e.imgUrl=t.url})}},t.uploadVote=function(){for(x in t.votes)t.votes[x].id=parseInt(x);t.uploadData.updated=new Date,t.uploadData._voteItems=t.votes,0===t.votes.length?Materialize.toast("请至少添加一个投票项！",1e3):t.uploadData.title?t.uploadData.max||t.uploadData.limit?t.isEdit?o.prototype_updateById_votes({id:localStorage.$LoopBack$currentTeamId,fk:n.id},t.uploadData,function(){Materialize.toast("修改成功！请在投票模板里查看",2e3),e.path("/MS/vote/list")},function(t){Materialize.toast(t.data.error.message||"更新失败",2e3)}):o.prototype_create_votes({id:localStorage.$LoopBack$currentTeamId},t.uploadData,function(){Materialize.toast("创建成功！请在投票模板里查看",2e3),e.path("/MS/vote/list")},function(t){Materialize.toast(t.data.error.message||"创建失败",2e3)}):Materialize.toast("请填写投票票数限制！",1e3):Materialize.toast("请填写投票名称！",1e3)}}]),app.controller("VoteResultCtrl",["$scope","$rootScope","$stateParams","Vote","Team","$interval",function(t,e,o,i,n,a){function c(){n.prototype_findById_votes({id:localStorage.$LoopBack$currentTeamId,fk:o.id},function(o){e.pageTitle="["+o.title+"]结果",t.vote=o,t.sum=0,t.vote._voteItems.forEach(function(e){t.sum+=e.count}),t.vote._voteItems.forEach(function(e){e.point=e.count/t.sum*100})})}c(),t.timer=void 0,t.realyTime=function(){t.timer=a(function(){c()},500)},t.cancelTimer=function(){a.cancel(t.timer),t.timer=void 0},t.$on("$destroy",function(){a.cancel(t.timer),t.timer=void 0}),t.ASCActive="active",t.DESCActive=!1,t.ASC=function(){t.DESCActive=!1,t.ASCActive="active",t.desc=!1},t.DESC=function(){t.DESCActive="active",t.ASCActive=!1,t.desc=!0},t.fullSreen=function(){var t=document.getElementById("voteResult");requestFullScreen(t)}}]);
!function(e,t,r){"use strict";var o="/api",s="authorization",i=t.module("lbServices",["ngResource"]);i.factory("School",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Schools/:id",{id:"@id"},{find:{url:o+"/Schools",params:{filter:{fields:["name"]}},method:"GET",isArray:!0},findOne:{url:o+"/Schools",method:"GET",isArray:!0}});return s.modelName="School",s}]),i.factory("Aouth",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Aouths/:id",{id:"@id"},{findById:{url:o+"/Aouths/:id",method:"GET"},deleteById:{url:o+"/Aouths/:id",method:"DELETE"}});return s.modelName="Aouth",s}]),i.factory("User",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/WUsers/:id",{id:"@id"},{prototype_create_replys:{url:o+"/WUsers/:id/replys",method:"POST"},prototype_create_comments:{url:o+"/WUsers/:id/comments",method:"POST"},prototype_create_articles:{url:o+"/WUsers/:id/articles",method:"POST"},prototype_create_likeUsers:{url:o+"/WUsers/:id/likeUsers",method:"POST"},auth2wechat:{url:o+"/WUsers/auth2wechat",method:"GET"},checkPhone:{url:o+"/WUsers/:id/checkPhone",method:"GET"},updateAll:{url:o+"/WUsers/updateAll",method:"GET"},prototype_create_coteries:{url:o+"/WUsers/:id/coteries",method:"POST"},prototype_updateById_coteries:{url:o+"/WUsers/:id/coteries/:fk",params:{fk:"@fk"},method:"PUT"},prototype_get_teams:{url:o+"/WUsers/:id/teams",method:"GET",isArray:!0},prototype_get_articles:{url:o+"/WUsers/:id/articles",method:"GET",isArray:!0},prototype_get_coteries:{url:o+"/WUsers/:id/coteries",method:"GET",isArray:!0},create:{url:o+"/WUsers",method:"POST"},confirmSchool:{url:o+"/WUsers/:id/confirmSchool",method:"POST"},prototype_create_formResults:{url:o+"/WUsers/:id/formResults",method:"POST"},prototype_findById_formResults:{url:o+"/WUsers/:id/formResults/:fk",params:{fk:"@fk"},method:"GET"},prototype_create_voteResults:{url:o+"/WUsers/:id/voteResults",method:"POST"},prototype_findById_voteResults:{url:o+"/WUsers/:id/voteResults/:fk",params:{fk:"@fk"},method:"GET"},prototype_create_seckillResults:{url:o+"/WUsers/:id/seckillResults",method:"POST"},prototype_findById_seckillResults:{url:o+"/WUsers/:id/seckillResults/:fk",params:{fk:"@fk"},method:"GET"},getMyTeams:{url:o+"/WUsers/:id/myTeams",method:"GET"},getInfo:{url:o+"/WUsers/info",method:"GET"},getActivitiesHistories:{url:o+"/WUsers/:id/activitiesHistories",method:"GET"},getRaceHistories:{url:o+"/WUsers/:id/raceHistories",method:"GET"},getLikeArticles:{url:o+"/WUsers/:id/likeArticles",method:"GET"},prototype_updateAttributes:{url:o+"/WUsers/:id",method:"PUT"},prototype_create_teams:{url:o+"/WUsers/:id/teams",method:"POST"},resetPassword:{url:o+"/WUsers/reset",method:"POST"},prototype_updateById_teams:{url:o+"/WUsers/:id/teams/:fk",params:{fk:"@fk"},method:"PUT"},login:{url:o+"/WUsers/login",method:"POST",params:{include:"user"},interceptor:{response:function(e){var r=e.data;return t.setUser(r.id,r.userId,r.user),t.rememberMe=e.config.params.rememberMe!==!1,t.save(),e.resource}}}});return s}]).factory("Team",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Teams/:id",{id:"@id"},{find:{url:o+"/Teams",method:"GET",isArray:!0},prototype_link_partakedRaces:{url:o+"/Teams/:id/partakedRaces/rel/:fk",params:{fk:"@fk"},method:"PUT"},prototype_get_partakedRaces:{url:o+"/Teams/:id/partakedRaces",method:"GET",isArray:!0},prototype_unlink_partakedRaces:{url:o+"/Teams/:id/partakedRaces/rel/:fk",method:"DELETE"},getMySchoolTeams:{url:o+"/Teams/mySchoolTeams",method:"GET"},findById:{url:o+"/Teams/:id",method:"GET"},prototype_updateAttributes:{url:o+"/Teams/:id",method:"PUT"},prototype_get_activities:{url:o+"/Teams/:id/activities",method:"GET",isArray:!0},prototype_create_activities:{url:o+"/Teams/:id/activities",method:"POST"},prototype_create_forms:{url:o+"/Teams/:id/forms",method:"POST"},prototype_findById_forms:{url:o+"/Teams/:id/forms/:fk",method:"GET"},prototype_updateById_forms:{url:o+"/Teams/:id/forms/:fk",method:"PUT"},prototype_create_votes:{url:o+"/Teams/:id/votes",method:"POST"},prototype_findById_votes:{url:o+"/Teams/:id/votes/:fk",method:"GET"},prototype_updateById_votes:{url:o+"/Teams/:id/votes/:fk",method:"PUT"},prototype_create_seckills:{url:o+"/Teams/:id/seckills",method:"POST"},prototype_findById_seckills:{url:o+"/Teams/:id/seckills/:fk",method:"GET"},prototype_updateById_seckills:{url:o+"/Teams/:id/seckills/:fk",method:"PUT"},prototype_get_seckills:{url:o+"/Teams/:id/seckills",method:"GET",isArray:!0},prototype_destroyById_seckills:{url:o+"/Teams/:id/seckills/:fk",method:"DELETE"},prototype_get_forms:{url:o+"/Teams/:id/forms",method:"GET",isArray:!0},prototype_destroyById_forms:{url:o+"/Teams/:id/forms/:fk",method:"DELETE"},prototype_get_votes:{url:o+"/Teams/:id/votes",method:"GET",isArray:!0},prototype_destroyById_votes:{url:o+"/Teams/:id/votes/:fk",method:"DELETE"},prototype_updateById_activities:{url:o+"/Teams/:id/activities/:fk",method:"PUT"},prototype_findById_activities:{url:o+"/Teams/:id/activities/:fk",method:"GET"},prototype_create_members:{url:o+"/Teams/:id/members",method:"POST"},prototype_get_members:{url:o+"/Teams/:id/members",method:"GET",isArray:!0},prototype_findById_members:{url:o+"/Teams/:id/members/:fk",params:{fk:"@fk"},method:"GET"},prototype_destroyById_members:{url:o+"/Teams/:id/members/:fk",params:{fk:"@fk"},method:"DELETE"},prototype_updateById_members:{url:o+"/Teams/:id/members/:fk",params:{fk:"@fk"},method:"PUT"},prototype_create_departments:{url:o+"/Teams/:id/departments",method:"POST"},prototype_destroyById_departments:{url:o+"/Teams/:id/departments/:fk",params:{fk:"@fk"},method:"DELETE"},prototype_get_races:{url:o+"/Teams/:id/races",method:"GET",isArray:!0},prototype_create_races:{url:o+"/Teams/:id/races",method:"POST"},prototype_updateById_races:{url:o+"/Teams/:id/races/:fk",method:"PUT"},prototype_findById_races:{url:o+"/Teams/:id/races/:fk",method:"GET"}});return s}]).factory("Article",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Articles/:id",{id:"@id"},{findById:{url:o+"/Articles/:id",method:"GET"},prototype_get_comments:{url:o+"/Articles/:id/comments",method:"GET",isArray:!0},prototype_create_readers:{url:o+"/Articles/:id/readers",method:"POST"}});return s}]).factory("Comment",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Comments/:id",{id:"@id"},{prototype_get_replys:{url:o+"/Comments/:id/replys",method:"GET",isArray:!0}});return s}]).factory("Notice",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Notices/:id",{id:"@id"},{prototype_create_form:{url:o+"/Notices/:id/form",method:"POST"}});return s}]).factory("Coterie",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Coteries/:id",{id:"@id"},{prototype_count_fans:{url:o+"/Coteries/:id/fans/count",method:"GET"},find:{url:o+"/Coteries",method:"GET",isArray:!0},prototype_get_articles:{url:o+"/Coteries/:id/articles",method:"GET",isArray:!0},prototype_findById_articles:{url:o+"/Coteries/:id/articles/:fk",params:{fk:"@fk"},method:"GET"},findById:{url:o+"/Coteries/:id",method:"GET"}});return s}]).factory("Activity",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Activities/:id",{id:"@id"},{getHotActiveties:{url:o+"/Activities/hotActiveties",method:"GET",isArray:!0},find:{url:o+"/Activities",method:"GET",isArray:!0},prototype_get_forms:{url:o+"/Activities/:id/forms",method:"GET",isArray:!0},prototype_get_votes:{url:o+"/Activities/:id/votes",method:"GET",isArray:!0},prototype_updateById_votes:{url:o+"/Activities/:id/votes/:fk",method:"PUT"},prototype_updateById_seckills:{url:o+"/Activities/:id/seckills/:fk",method:"PUT"},prototype_get_seckills:{url:o+"/Activities/:id/seckills",method:"GET",isArray:!0},prototype_create_forms:{url:o+"/Activities/:id/forms",method:"POST"},prototype_create_votes:{url:o+"/Activities/:id/votes",method:"POST"},prototype_create_seckills:{url:o+"/Activities/:id/seckills",method:"POST"},prototype_updateById_forms:{url:o+"/Activities/:id/forms/:fk",method:"PUT"},prototype_delete_forms:{url:o+"/Activities/:id/forms",method:"DELETE"},prototype_delete_votes:{url:o+"/Activities/:id/votes",method:"DELETE"},prototype_delete_seckills:{url:o+"/Activities/:id/seckills",method:"DELETE"},getMySchoolActiveties:{url:o+"/Activities/mySchoolActiveties",method:"GET"},search:{url:o+"/Activities/search",method:"GET",isArray:!0},prototype_create_readers:{url:o+"/Activities/:id/readers",method:"POST"},findById:{url:o+"/Activities/:id",method:"GET"}});return s}]).factory("Seckill",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Seckills/:id",{id:"@id"},{prototype_get_seckillResults:{url:o+"/Seckills/:id/seckillResults",method:"GET",isArray:!0},prototype_updateById_seckillResults:{url:o+"/Seckills/:id/seckillResults/:fk",method:"PUT"}});return s}]).factory("Form",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Forms/:id",{id:"@id"},{prototype_get_formResults:{url:o+"/Forms/:id/formResults",method:"GET",isArray:!0},excel:{url:o+"/Forms/:id/excel",method:"GET"}});return s}]).factory("Vote",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Votes/:id",{id:"@id"},{prototype_get_voteResults:{url:o+"/Votes/:id/voteResults",method:"GET",isArray:!0}});return s}]).factory("Race",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Races/:id",{id:"@id"},{find:{url:o+"/Races",method:"GET",isArray:!0},getMySchoolRaces:{url:o+"/Races/mySchoolRaces",method:"GET"},findById:{url:o+"/Races/:id",method:"GET"},prototype_get_notices:{url:o+"/Races/:id/notices",method:"GET",params:{filter:{order:"id DESC",include:"form",where:{deleted:!1}}},isArray:!0},prototype_create_notices:{url:o+"/Races/:id/notices",method:"POST"},prototype_updateById_notices:{url:o+"/Races/:id/notices/:fk",method:"PUT"},prototype_get_raceTeams:{url:o+"/Races/:id/raceTeams",params:{filter:{fields:["id","name","logoUrl","status","desc"],include:{relation:"members",scope:{fields:["name","academy","userId","department","phone"]}}}},method:"GET",isArray:!0},prototype_unlink_raceTeams:{url:o+"/Races/:id/raceTeams/rel/:fk",method:"DELETE"},prototype_get_materials:{url:o+"/Races/:id/materials",method:"GET",isArray:!0},prototype_updateById_materials:{url:o+"/Races/:id/materials/:fk",method:"PUT"},prototype_destroyById_materials:{url:o+"/Races/:id/materials/:fk",method:"DELETE"},prototype_create_materials:{url:o+"/Races/:id/materials",method:"POST"}});return s}]).factory("LoopBackAuth",function(){function e(){var e=this;s.forEach(function(t){e[t]=o(t)}),this.rememberMe=r,this.currentUserData=null}function t(e,t,r){var o=i+t;null==r&&(r=""),e[o]=r}function o(e){var t=i+e;return localStorage[t]||sessionStorage[t]||null}var s=["accessTokenId","currentUserId"],i="$LoopBack$";return e.prototype.save=function(){var e=this,r=this.rememberMe?localStorage:sessionStorage;s.forEach(function(o){t(r,o,e[o])})},e.prototype.setUser=function(e,t,r){this.accessTokenId=e,this.currentUserId=t,this.currentUserData=r},e.prototype.clearUser=function(){this.accessTokenId=null,this.currentUserId=null,this.currentUserData=null},e.prototype.clearStorage=function(){s.forEach(function(e){t(sessionStorage,e,null),t(localStorage,e,null)})},new e}).config(["$httpProvider",function(e){e.interceptors.push("LoopBackAuthRequestInterceptor")}]).factory("LoopBackAuthRequestInterceptor",["$q","$rootScope","LoopBackAuth",function(e,t,i){return{request:function(t){if(t.url.substr(0,o.length)!==o)return t;if(i.accessTokenId)t.params=t.params||{},t.params.access_token=i.accessTokenId,t.headers[s]=i.accessTokenId;else if(t.__isGetCurrentUser__){var a={body:{error:{status:401}},status:401,config:t,headers:function(){return r}};return e.reject(a)}return t||e.when(t)},responseError:function(r){switch(r.status){case 401:"/api/WUsers/login"!==r.config.url&&t.$broadcast("auth:loginRequired");break;case 500:t.$broadcast("error:unknown",r)}return e.reject(r)}}}]).provider("LoopBackResource",function(){this.setAuthHeader=function(e){s=e},this.setUrlBase=function(e){o=e},this.getUrlBase=function(){return o},this.$get=["$resource",function(e){return function(t,r,o){var s=e(t,r,o);return s.prototype.$save=function(e,t){var r=s.upsert.call(this,{},this,e,t);return r.$promise||r},s}}]})}(window,window.angular);
!function(e){e.module("ue.config",[]).factory("Ueditor",["$rootScope",function(e){function r(){if(e.teamInfo)var r="team",t=e.teamInfo.id;else{if(!e.$currentUser)return;var r="user",t=e.$currentUser.id}var i="/ue/uploads?dir="+r+"&id="+t;return{serverUrl:i,toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","|","justifyleft","justifycenter","justifyright","justifyjustify","|","simpleupload","insertimage","attachment","insertvideo","music"]],initialFrameHeight:300,wordCount:!1,elementPathEnabled:!1,enableContextMenu:!1}}return{config:r()}}])}(window.angular);
!function(t){var e=t.module("ng.upload",[]);e.factory("uploadFile",["$http",function(e){return{file:function(a,n,o){var d=new FormData,i="/ue/uploads?dir="+n+"&id="+o+"&action=uploadfile";return d.append("file",a),e({url:i,data:d,method:"POST",headers:{"Content-Type":void 0},transformRequest:t.identity})},text:function(t,a,n){return e({url:"/ue/uploads?dir="+a+"&id="+n+"&action=uploadtext",method:"post",data:{content:t}})},img:function(a,n,o){var d=new FormData,i="/ue/uploads?dir="+n+"&id="+o+"&action=uploadimage";return d.append("file",a),e({url:i,data:d,method:"POST",headers:{"Content-Type":void 0},transformRequest:t.identity})}}}])}(window.angular);
!function(e){e.module("ui.materialize",["ui.materialize.ngModel","ui.materialize.collapsible","ui.materialize.toast","ui.materialize.sidenav","ui.materialize.material_select","ui.materialize.dropdown","ui.materialize.inputfield","ui.materialize.input_date","ui.materialize.tabs","ui.materialize.pagination","ui.materialize.pushpin","ui.materialize.scrollspy","ui.materialize.parallax","ui.materialize.modal","ui.materialize.tooltipped","ui.materialize.slider","ui.materialize.materialboxed"]),e.module("ui.materialize.ngModel",[]).directive("ngModel",["$timeout",function(e){return{restrict:"A",priority:-1,link:function(i,t,n){i.$watch(n.ngModel,function(i){e(function(){i?t.trigger("change"):void 0===t.attr("placeholder")&&(t.is(":focus")||t.trigger("blur"))})})}}}]),e.module("ui.materialize.slider",[]).directive("slider",["$timeout",function(i){return{restrict:"A",scope:{height:"=",transition:"=",interval:"=",indicators:"="},link:function(t,n,a){n.addClass("slider"),i(function(){n.slider({height:e.isDefined(t.height)?t.height:200,transition:e.isDefined(t.transition)?t.transition:500,interval:e.isDefined(t.interval)?t.interval:6e3,indicators:e.isDefined(t.indicators)?t.indicators:!0})})}}}]),e.module("ui.materialize.collapsible",[]).directive("collapsible",["$timeout",function(e){return{link:function(i,t,n){e(function(){t.collapsible()}),"watch"in n&&i.$watch(function(){return t[0].innerHTML},function(i,n){i!==n&&e(function(){t.collapsible()})})}}}]),e.module("ui.materialize.parallax",[]).directive("parallax",["$timeout",function(e){return{link:function(i,t,n){e(function(){t.parallax()})}}}]),e.module("ui.materialize.toast",[]).constant("toastConfig",{duration:3e3}).directive("toast",["toastConfig",function(i){return{scope:{message:"@",duration:"@",callback:"&"},link:function(t,n,a){n.bind(a.toast,function(){var n=e.isDefined(t.message)?t.message:"",o=e.isDefined(a.toastclass)?a.toastclass:"";Materialize.toast(n,t.duration?t.duration:i.duration,o,t.callback)})}}}]),e.module("ui.materialize.pushpin",[]).directive("pushpin",[function(){return{restrict:"AE",require:["?pushpinTop","?pushpinOffset","?pushpinBottom"],link:function(e,i,t){var n=t.pushpinTop||0,a=t.pushpinOffset||0,o=t.pushpinBottom||1/0;setTimeout(function(){i.pushpin({top:n,offset:a,bottom:o})},0)}}}]),e.module("ui.materialize.scrollspy",[]).directive("scrollspy",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){t.addClass("scrollspy"),e(function(){t.scrollSpy()})}}}]),e.module("ui.materialize.tabs",[]).directive("tabs",[function(){return{link:function(e,i,t){i.tabs()}}}]),e.module("ui.materialize.sidenav",[]).directive("sidenav",[function(){return{scope:{menuwidth:"@",closeonclick:"@"},link:function(i,t,n){t.sideNav({menuWidth:e.isDefined(i.menuwidth)?i.menuwidth:void 0,edge:n.sidenav?n.sidenav:"left",closeOnClick:e.isDefined(i.closeonclick)?"true"==i.closeonclick:void 0})}}}]),e.module("ui.materialize.material_select",[]).directive("materialSelect",["$compile","$timeout",function(e,i){return{link:function(t,n,a){function o(){n.siblings(".caret").remove(),n.material_select()}n.is("select")&&(e(n.contents())(t),i(o),a.ngModel&&t.$watch(a.ngModel,o),"watch"in a&&t.$watch(function(){return n[0].innerHTML},function(e,t){e!==t&&i(o)}))}}}]),e.module("ui.materialize.dropdown",[]).directive("dropdown",["$compile","$timeout",function(i,t){return{scope:{inDuration:"@",outDuration:"@",constrainWidth:"@",hover:"@",alignment:"@",gutter:"@",belowOrigin:"@"},link:function(n,a,o){t(function(){i(a.contents())(n),a.dropdown({inDuration:e.isDefined(n.inDuration)?n.inDuration:void 0,outDuration:e.isDefined(n.outDuration)?n.outDuration:void 0,constrain_width:e.isDefined(n.constrainWidth)?n.constrainWidth:void 0,hover:e.isDefined(n.hover)?n.hover:void 0,alignment:e.isDefined(n.alignment)?n.alignment:void 0,gutter:e.isDefined(n.gutter)?n.gutter:void 0,belowOrigin:e.isDefined(n.belowOrigin)?n.belowOrigin:void 0})})}}}]),e.module("ui.materialize.inputfield",[]).directive("inputField",["$compile","$timeout",function(i,t){return{transclude:!0,scope:{},link:function(i,n){t(function(){Materialize.updateTextFields(),n.find("> > .materialize-textarea").each(function(){var e=$(this);e.addClass("materialize-textarea"),e.trigger("autoresize");var n=e.attr("ng-model");n&&i.$parent.$watch(n,function(i,n){i!==n&&t(function(){e.trigger("autoresize")})})}),n.find("> > .materialize-textarea, > > input").each(function(i,t){t=e.element(t),t.siblings('span[class="character-counter"]').length||t.characterCounter()})})},template:'<div ng-transclude class="input-field"></div>'}}]),e.module("ui.materialize.input_date",[]).directive("inputDate",["$compile","$timeout",function(i,t){var n=$("<style>#inputCreated_root {outline: none;}</style>");$("html > head").append(n);var a=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,t=/[^-+\dA-Z]/g,n=function(e,i){for(e=String(e),i=i||2;e.length<i;)e="0"+e;return e};return function(o,r,l){var s=a;if(1!==arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(r=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");r=String(s.masks[r]||r||s.masks["default"]),"UTC:"==r.slice(0,4)&&(r=r.slice(4),l=!0);var d=l?"getUTC":"get",u=o[d+"Date"](),c=o[d+"Day"](),m=o[d+"Month"](),f=o[d+"FullYear"](),p=o[d+"Hours"](),v=o[d+"Minutes"](),g=o[d+"Seconds"](),h=o[d+"Milliseconds"](),y=l?0:o.getTimezoneOffset(),D={d:u,dd:n(u),ddd:s.i18n.dayNames[c],dddd:s.i18n.dayNames[c+7],m:m+1,mm:n(m+1),mmm:s.i18n.monthNames[m],mmmm:s.i18n.monthNames[m+12],yy:String(f).slice(2),yyyy:f,h:p%12||12,hh:n(p%12||12),H:p,HH:n(p),M:v,MM:n(v),s:g,ss:n(g),l:n(h,3),L:n(h>99?Math.round(h/10):h),t:12>p?"a":"p",tt:12>p?"am":"pm",T:12>p?"A":"P",TT:12>p?"AM":"PM",Z:l?"UTC":(String(o).match(i)||[""]).pop().replace(t,""),o:(y>0?"-":"+")+n(100*Math.floor(Math.abs(y)/60)+Math.abs(y)%60,4),S:["th","st","nd","rd"][u%10>3?0:(u%100-u%10!=10)*u%10]};return r.replace(e,function(e){return e in D?D[e]:e.slice(1,e.length-1)})}}();a.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},a.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,i){return a(this,e,i)};var o=function(e){return"[object Date]"===Object.prototype.toString.call(e)?!isNaN(e.getTime()):!1};return{require:"ngModel",scope:{container:"@",format:"@",formatSubmit:"@",monthsFull:"@",monthsShort:"@",weekdaysFull:"@",weekdaysLetter:"@",firstDay:"=",disable:"=",today:"=",clear:"=",close:"=",selectYears:"=",onStart:"&",onRender:"&",onOpen:"&",onClose:"&",onSet:"&",onStop:"&",ngReadonly:"=?",max:"@",min:"@"},link:function(n,a,r,l){l.$formatters.unshift(function(i){if(i){var t=new Date(i);return e.isDefined(n.format)?t.format(n.format):t.format("d mmmm, yyyy")}return null});var s=e.isDefined(n.monthsFull)?n.$eval(n.monthsFull):void 0,d=e.isDefined(n.monthsShort)?n.$eval(n.monthsShort):void 0,u=e.isDefined(n.weekdaysFull)?n.$eval(n.weekdaysFull):void 0,c=e.isDefined(n.weekdaysLetter)?n.$eval(n.weekdaysLetter):void 0;i(a.contents())(n),n.ngReadonly||t(function(){var i=a.pickadate({container:e.isDefined(n.container)?n.container:"body",format:e.isDefined(n.format)?n.format:void 0,formatSubmit:e.isDefined(n.formatSubmit)?n.formatSubmit:void 0,monthsFull:e.isDefined(s)?s:void 0,monthsShort:e.isDefined(d)?d:void 0,weekdaysFull:e.isDefined(u)?u:void 0,weekdaysLetter:e.isDefined(c)?c:void 0,firstDay:e.isDefined(n.firstDay)?n.firstDay:0,disable:e.isDefined(n.disable)?n.disable:void 0,today:e.isDefined(n.today)?n.today:void 0,clear:e.isDefined(n.clear)?n.clear:void 0,close:e.isDefined(n.close)?n.close:void 0,selectYears:e.isDefined(n.selectYears)?n.selectYears:void 0,onStart:e.isDefined(n.onStart)?function(){n.onStart()}:void 0,onRender:e.isDefined(n.onRender)?function(){n.onRender()}:void 0,onOpen:e.isDefined(n.onOpen)?function(){n.onOpen()}:void 0,onClose:e.isDefined(n.onClose)?function(){n.onClose()}:void 0,onSet:e.isDefined(n.onSet)?function(){n.onSet()}:void 0,onStop:e.isDefined(n.onStop)?function(){n.onStop()}:void 0}),t=i.pickadate("picker");n.$watch("max",function(e){if(t){var i=new Date(e);t.set({max:o(i)?i:!1})}}),n.$watch("min",function(e){if(t){var i=new Date(e);t.set({min:o(i)?i:!1})}})})}}}]),e.module("ui.materialize.pagination",[]).directive("pagination",function(){function e(e,i){e.List=[],e.Hide=!1,e.page=parseInt(e.page)||1,e.total=parseInt(e.total)||0,e.dots=e.dots||"...",e.ulClass=e.ulClass||i.ulClass||"pagination",e.adjacent=parseInt(e.adjacent)||2,e.activeClass="active",e.disabledClass="disabled",e.scrollTop=e.$eval(i.scrollTop),e.hideIfEmpty=e.$eval(i.hideIfEmpty),e.showPrevNext=e.$eval(i.showPrevNext)}function i(e,i){e.page>i&&(e.page=i),e.page<=0&&(e.page=1),e.adjacent<=0&&(e.adjacent=2),1>=i&&(e.Hide=e.hideIfEmpty)}function t(e,i){e.page!=i&&(e.page=i,e.paginationAction({page:i}),e.scrollTop&&scrollTo(0,0))}function n(e,i,n){var a=0;for(a=e;i>=a;a++){var o={value:a.toString(),liClass:n.page==a?n.activeClass:"waves-effect",action:function(){t(n,this.value)}};n.List.push(o)}}function a(e){e.List.push({value:e.dots})}function o(e,i){n(1,2,e),3!=i&&a(e)}function r(e,i,n){if(e.showPrevNext&&!(1>i)){var a,o,r;if("prev"===n){a=e.page-1<=0;var l=e.page-1<=0?1:e.page-1;o={value:"<<",title:"First Page",page:1},r={value:"<",title:"Previous Page",page:l}}else{a=e.page+1>i;var s=e.page+1>=i?i:e.page+1;o={value:">",title:"Next Page",page:s},r={value:">>",title:"Last Page",page:i}}var d=function(i,n){e.List.push({value:i.value,title:i.title,liClass:n?e.disabledClass:"",action:function(){n||t(e,i.page)}})};d(o,a),d(r,a)}}function l(e,i,t){t!=e-2&&a(i),n(e-1,e,i)}function s(t,a){if(t.pageSize&&!(t.pageSize<0)){e(t,a);var s,d=2*t.adjacent,u=Math.ceil(t.total/t.pageSize);if(i(t,u),r(t,u,"prev"),5+d>u)s=1,n(s,u,t);else{var c;t.page<=1+d?(s=1,c=2+d+(t.adjacent-1),n(s,c,t),l(u,t,c)):u-d>t.page&&t.page>d?(s=t.page-t.adjacent,c=t.page+t.adjacent,o(t,s),n(s,c,t),l(u,t,c)):(s=u-(1+d+(t.adjacent-1)),c=u,o(t,s),n(s,c,t))}r(t,u,"next")}}return{restrict:"EA",scope:{page:"=",pageSize:"=",total:"=",dots:"@",hideIfEmpty:"@",adjacent:"@",scrollTop:"@",showPrevNext:"@",paginationAction:"&",ulClass:"=?"},template:'<ul ng-hide="Hide" ng-class="ulClass"> <li ng-class="Item.liClass" ng-click="Item.action()" ng-repeat="Item in List"> <a href> <span ng-bind="Item.value"></span> </a></ul>',link:function(e,i,t){e.$watchCollection("[page, total, pageSize]",function(){s(e,t)})}}}),e.module("ui.materialize.modal",[]).directive("modal",["$compile","$timeout",function(i,t){return{scope:{dismissible:"=",opacity:"@",inDuration:"@",outDuration:"@"},link:function(n,a,o){t(function(){i(a.contents())(n),a.leanModal({dismissible:e.isDefined(n.dismissible)?n.dismissible:void 0,opacity:e.isDefined(n.opacity)?n.opacity:void 0,in_duration:e.isDefined(n.inDuration)?n.inDuration:void 0,out_duration:e.isDefined(n.outDuration)?n.outDuration:void 0})})}}}]),e.module("ui.materialize.tooltipped",[]).directive("tooltipped",["$compile","$timeout",function(e,i){return{restrict:"EA",scope:!0,link:function(t,n,a){n.addClass("tooltipped"),e(n.contents())(t),i(function(){n.tooltip()}),t.$on("$destroy",function(){n.tooltip("remove")})}}}]),e.module("ui.materialize.materialboxed",[]).directive("materialboxed",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){e(function(){t.materialbox()})}}}])}(angular);