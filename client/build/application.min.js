app.controller("ActivitiesController",["$scope","Activity","$window",function(t,e,i){function r(t){var e=new Date;try{new Date(t.ended)<e?t.status="end":new Date(t.started)>e?t.status="nos":t.status="ing"}catch(i){}return t}t.activityFilter=["全部","进行中","未开始","已结束"],t.choice="全部",i.pull=!0,t.activityItems=[],t.filterBar="ng-hide";var n=0,a=0;t.changeFilter=function(){t.choice=this.filter},angular.element(i).bind("scroll",function(e){var r=e.target.body;r.scrollHeight-r.clientHeight-r.scrollTop<600&&i.pull&&!t.last?(t.getActivities(),i.pull=!1):r.scrollHeight-r.clientHeight-r.scrollTop>600&&(i.pull=!0)}),t.$on("$destroy",function(e,r){angular.element(i).unbind("scroll"),t.activityItems=void 0}),t.formFilter=function(){t.query={actType:"form"},n=0,t.last=!1,t.activityItems=[],t.getActivities(),t.typeHide=!0,t.type="表单"},t.voteFilter=function(){t.query={actType:"vote"},n=0,t.last=!1,t.activityItems=[],t.getActivities(),t.typeHide=!0,t.type="投票"},t.seckillFilter=function(){t.query={actType:"seckill"},n=0,t.last=!1,t.activityItems=[],t.getActivities(),t.typeHide=!0,t.type="抢票"},t.allTypeFilter=function(){t.query=void 0,a=0,n=0,t.activityItems=[],t.getActivities(),t.typeHide=!0,t.type="类型"},t.allStatusFilter=function(){t.query=void 0,a=0,n=0,t.activityItems=[],t.getActivities(),t.status="状态",t.statusHide=!0},t.ingFilter=function(){t.query={status:"ing"},t.statusHide=!0,a=1,n=0,t.last=!1,t.activityItems=[],t.getActivities(),t.status="进行中"},t.nosFilter=function(){t.query={status:"nos"},t.statusHide=!0,a=2,n=0,t.last=!1,t.activityItems=[],t.getActivities(),t.status="未开始"},t.endFilter=function(){t.query={status:"end"},t.statusHide=!0,a=-1,n=0,t.last=!1,t.activityItems=[],t.getActivities(),t.status="已结束"},t.titleFilter=function(){this.filterTitle?t.query={title:this.filterTitle}:t.query=void 0},t.getActivities=function(){if(!t.$currentUser)return void t.$emit("auth:loginRequired");var i=t.query||{},o=i.actType||"all";e.getMySchoolActiveties({school:t.$currentUser.school,actType:o,status:a,page:n,filter:{order:"created DESC"}},function(e){for(x in e)"activties"===x&&(n++,(e[x].length<16||0===e[x].length)&&(t.last=!0),e[x].forEach(function(e){t.activityItems.push(r(e))}))})},t.$currentUser?t.getActivities():e.find(function(e){t.activityItems=e,t.activityItems.forEach(function(t){r(t)})})}]),app.directive("ngTap",function(){return function(t,e,i){var r;return r=!1,e.bind("click",function(){return r?void 0:t.$apply(i.ngTap)}),e.bind("touchstart",function(t){return r=!0}),e.bind("touchmove",function(t){return r=!1,t.stopImmediatePropagation()}),e.bind("touchend",function(){return r?t.$apply(i.ngTap):void 0})}}),app.controller("ActivityController",["$scope","Activity","User","$stateParams","$interval","uploadFile","$location","Article","$rootScope",function(t,e,i,r,n,a,o,s,c){function l(t){var e=t%60,i=Math.floor(t/86400),r=Math.floor((t-3600*i*24)/3600),n=Math.floor((t-3600*i*24-3600*r)/60);return{d:i,h:r,m:n,s:e}}function u(){v=n(function(){e.prototype_get_seckills({id:r.id},function(e){t.seckill=e[0]})},1e3)}var v,d;e.findById({id:r.id},function(i){t.activity=i,t.article=i,s.prototype_get_comments({id:i.id,filter:{order:"created DESC"}},function(e){t.article.comments=e,t.article.showCommentBox=!0}),"common"!==i.actType&&e["prototype_get_"+i.actType+"s"]({id:r.id},function(e){if(t[i.actType]=e[0],"seckill"===i.actType){var r=Math.floor((new Date(t.seckill.started)-new Date(t.seckill.serverTime))/1e3),a=l(r);t.countDown=r,t.seckillTime=a,d=n(function(){r--;var e=r%60,i=Math.floor(r/86400),a=Math.floor((r-3600*i*24)/3600),o=Math.floor((r-3600*i*24-3600*a)/60);t.seckillTime={d:i,h:a,m:o,s:e},0>=r&&n.cancel(d)},1e3)}})}),t.$on("$destroy",function(){n.cancel(d),n.cancel(v)}),t.onClickJoinActivity=function(){var e=t.activity.actType;t.activityEnded=!1,t.$currentUser||t.$emit("auth:loginRequired"),t.$currentUser&&"学号"===t.activity.verifyRule?t.activity.verifyId=t.$currentUser.studentId:t.$currentUser&&"手机"===t.activity.verifyRule&&(t.activity.verifyId=t.$currentUser.phone),"common"!==e&&(t.result=new Array(t[e]["_"+e+"Items"].length)),new Date-new Date(t.activity.ended)>0&&(t.activityEnded=!0)},t.checkedForVote=function(){var e=t.result.filter(function(t){return t});return t.vote.max&&e.length>t.vote.max?(this.result[this.$index]=void 0,void Materialize.toast("只能选择"+t.vote.max+"项哦",2e3)):void(this.result[this.$index]?this.voteIteam.count++:this.voteIteam.count--)},t.submitFormResult=function(){if(!t.$currentUser)return t.$emit("auth:loginRequired");if(t.activity.verifyRule&&!t.activity.verifyId)return void Materialize.toast("请填写验证规则",2e3);for(var e in t.form._formItems)"select"===t.form._formItems[e].type?(t.result[e].type="selelct",t.result[e].name=t.result[e].option,t.result[e].option=void 0):t.result[e].type=t.form._formItems[e].type;var r={verifyId:t.activity.verifyId,formId:t.form.id,created:new Date,result:t.result};i.prototype_create_formResults({id:t.$currentUser.id},r,function(t){1e3===t.status||1100===t.status?Materialize.toast(t.message,2e3):Materialize.toast("参与成功,可在个人主页查看结果",4e3)})},t.uploadFile=function(){if(!t.$currentUser)return t.$emit("auth:loginRequired");var e=this.$parent;t.result[e.$index]={};var i=document.getElementById("file").files[0];if(i){var r=t.tem;a.file(i,"user",t.$currentUser.id).success(function(i){t.result[e.$index].name=r,t.result[e.$index].url=i.url})}},t.submitVoteResult=function(){var e=[];if(!t.$currentUser)return t.$emit("auth:loginRequired");if(t.activity.verifyRule&&!t.activity.verifyId)return void Materialize.toast("请填写验证规则",2e3);for(var r in t.result)t.result[r]&&e.push(t.vote._voteItems[r].id);if(t.vote.limit&&e.length<t.vote.limit)return void Materialize.toast("必须选择"+t.vote.limit+"项哦",2e3);if(t.vote.max&&e.length>t.vote.max)return void Materialize.toast("只能选择"+t.vote.max+"项哦",2e3);if(e.length<=0)return void Materialize.toast("至少选择一项哦",2e3);var n={verifyId:t.activity.verifyId,voteId:t.vote.id,created:new Date,result:e};i.prototype_create_voteResults({id:t.$currentUser.id},n,function(t){1e3===t.status?Materialize.toast(t.message,2e3):Materialize.toast("参与成功,可在个人主页查看结果",4e3)})},t.submitSeckillResult=function(){if(!t.$currentUser)return t.$emit("auth:loginRequired");if(t.activity.verifyRule&&!t.activity.verifyId)return void Materialize.toast("请填写验证规则",800);var e={created:new Date,verifyId:t.activity.verifyId,itemId:this.seckillItem.id,seckillId:t.seckill.id};i.prototype_create_seckillResults({id:t.$currentUser.id},e,function(e){1e3===e.status||1100===e.status?(Materialize.toast(e.message,500),t.activityEnded=!0):(Materialize.toast("参与成功,可在个人主页查看结果",4e3),u())})}}]);
app.config(["$stateProvider","$urlRouterProvider",function(t,i){i.when("","/application/views/activity/index.html"),t.state("art.activities",{url:"/activities",controller:"ActivitiesController",templateUrl:"/application/views/activity/index.html"}).state("art.activity",{url:"/:id/detail",controller:"ActivityDetailController",templateUrl:"/application/views/activity/detail.html"}).state("activity",{url:"/w/activities/:id",controller:"ActivityController",templateUrl:"application/views/activity/detail.html"})}]);
app.controller("CoteriesController",["$scope","User","Coterie","$location",function(e,t,r,i){function o(){t.prototype_get_coteries({id:e.$currentUser.id},function(t){e.coteries=t,t.length&&!i.path().match(/\/w\/coteries\/.+/)&&i.path("/w/coteries/"+e.coteries[0].id)})}e.more=!1,e.moreOrBack=e.more?"返回":"发现",e.goLogin=function(){return e.$currentUser?void 0:e.$emit("auth:loginRequired")},e.moreCoteries=function(){if(e.more=!e.more,e.more)r.find(function(t){e.coteries=t});else{if(!e.$currentUser)return e.$emit("auth:loginRequired");o()}e.moreOrBack=e.more?"返回":"发现"},e.$currentUser&&o()}]),app.controller("CoterieController",["$scope","$stateParams","Coterie","User","Ueditor","$http","$location",function(e,t,r,i,o,n,c){r.findById({id:t.id},function(r){e.coterie=r,e.$emit("shareContentArrive",{bdText:r.name,bdPic:r.logoUrl}),r.isAttentioned&&i.prototype_updateById_coteries({id:e.$currentUser.id,fk:t.id},{lastView:new Date},function(e){},function(e){console.log(e)})}),r.prototype_get_articles({id:t.id},function(t){e.articles=t},function(){}),e.editorConfig=o.config,e.article={},e.createArticle=function(){if(!e.$currentUser)return e.$emit("auth:loginRequired");var r=e.articleEditorContent,o=e.article.title;return r&&o?void n({url:"/ue/uploads?dir=user&id="+e.$currentUser.id+"&action=uploadtext",method:"post",data:{content:e.articleEditorContent}}).success(function(r){e.article.contentUrl=r.url,e.article.created=new Date,e.article.coterieId=t.id,i.prototype_create_articles({id:e.$currentUser.id},e.article,function(e){console.log(e),Materialize.toast("文章发布成功",2e3),c.path("/w/coteries/"+t.id)})}):void Materialize.toast("文章标题和内容都不能为空",2e3)},e.attention=function(){return e.$currentUser?void i.prototype_create_coteries({id:e.$currentUser.id},{lastView:new Date,coterieId:t.id},function(t){e.coterie.isAttentioned=!0,Materialize.toast("关注成功！",2e3)},function(e){console.log(e),Materialize.toast("关注失败！",2e3)}):e.$emit("auth:loginRequired")},e.addLike=function(){if(!e.$currentUser)return e.$emit("auth:loginRequired");var t=this.article;i.prototype_create_likeUsers({id:e.$currentUser.id},{articleId:t.id,created:new Date},function(e){1===e.status&&(t.likeCount++,t.islike=!0,Materialize.toast("文章收藏成功",2e3))})}}]),app.controller("ArticlesController",["$scope","Article","User",function(e,t,r){e.addLike=function(){if(!e.$currentUser)return e.$emit("auth:loginRequired");var t=this.article;r.prototype_create_likeUsers({id:e.$currentUser.id},{articleId:t.id,created:new Date},function(e){1===e.status&&(t.likeCount++,t.islike=!0,Materialize.toast("文章收藏成功",2e3))})},e.deleteLike=function(){var t=this.article;r.prototype_get_likeUsers({id:e.$currentUser.id,filter:{where:{articleId:this.article.id}}},function(i){r.prototype_destroyById_likeUsers({id:e.$currentUser.id,fk:i[0].id},function(){t.likeCount--,t.islike=!1,Materialize.toast("文章取消收藏成功",2e3)})})},e.loadComment=function(){var e=this.article;return this.article.commentTextarea=!0,e.showCommentBox?void(e.showCommentBox=!1):(t.prototype_get_comments({id:e.id,filter:{order:"created DESC"}},function(t){e.comments=t}),void(e.showCommentBox=!0))}}]),app.controller("CommentsController",["$scope","Comment","User","Article","$interval",function(e,t,r,i,o){e.createComment=function(){var t=this.article;return e.$currentUser?t.writingCommentContent?void r.prototype_create_comments({id:e.$currentUser.id},{articleId:t.id,created:new Date,content:t.writingCommentContent},function(r){r.user={headImgUrl:e.$currentUser.headImgUrl,id:e.$currentUser.id,name:e.$currentUser.name},t.commentCount++,r.replyCount=0,t.comments.splice(0,0,r),t.writingCommentContent=null,Materialize.toast("评论成功",2e3)}):void Materialize.toast("请先输入评论内容",2e3):e.$emit("auth:loginRequired")},e.reload=function(){i.prototype_get_comments({id:this.article.id,filter:{order:"created DESC"}},function(t){e.article.comments=t})},e.loadReply=function(){var e=this.comment;t.prototype_get_replys({id:this.comment.id},function(t){e.replys=t})},e.createReply=function(){var t=this.comment;return e.$currentUser?t.writingReplyContent?void r.prototype_create_replys({id:e.$currentUser.id},{commentId:t.id,created:new Date,content:t.writingReplyContent},function(r){r.user={id:e.$currentUser.id,name:e.$currentUser.name},t.replyCount++,t.replys.push(r),t.writingReplyContent=null,Materialize.toast("回复成功",2e3)}):void Materialize.toast("请先输入回复内容",2e3):e.$emit("auth:loginRequired")}}]),app.controller("ArticleController",["$scope","$stateParams","User","Coterie","Article","Comment",function(e,t,r,i,o,n){e.$currentUser||(e.$currentUser={},e.$currentUser.id=0),o.findById({id:t.id},function(r){e.article=r,e.$emit("shareContentArrive",{bdText:r.title}),o.prototype_get_comments({id:t.id},function(t){e.article.comments=t}),e.article.showCommentBox=!0}),o.prototype_create_readers({id:t.id},{userId:e.$currentUser.id,form:"pc"}),e.addLike=function(){if(!e.$currentUser)return e.$emit("auth:loginRequired");var t=this.article;r.prototype_create_likeUsers({id:e.$currentUser.id},{articleId:t.id,created:new Date},function(e){1===e.status&&(t.likeCount++,t.islike=!0,Materialize.toast("文章收藏成功",2e3))})},e.deleteLike=function(){var t=this.article;r.prototype_get_likeUsers({id:e.$currentUser.id,filter:{where:{articleId:this.article.id}}},function(i){r.prototype_destroyById_likeUsers({id:e.$currentUser.id,fk:i[0].id},function(){t.likeCount--,t.islike=!1,Materialize.toast("文章取消收藏成功",2e3)})})}}]);
app.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("coteries",{url:"/w/coteries",controller:"CoteriesController",templateUrl:"application/views/coterie/index.html"}).state("coteries.articles",{url:"/:id",controller:"CoterieController",templateUrl:"application/views/coterie/detail.html"}).state("edit",{url:"/w/articles/:id/edit",controller:"CoterieController",templateUrl:"application/views/coterie/edit.html"}).state("coterie",{url:"/w/coteries/:id/articles",controller:"CoterieController",templateUrl:"application/views/coterie/detail.html"}).state("article",{url:"/w/articles/:id",controller:"ArticleController",templateUrl:"application/views/coterie/article.html"})}]);
function createQrcode(e,t){document.getElementById(t).innerHTML=null;new QRCode(document.getElementById(t),{text:e,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.M})}function userAuthSave(e,t,r){e.user.id=e.userId,t.cancelLogin(),e.user.accessToken=e.id,t.$currentUser=e.user,t.username=e.user.name,localStorage.$LoopBack$accessTokenId=e.id,localStorage.$LoopBack$currentUserId=e.userId,r.setUser(e.id,e.userId,e.user),r.save(),localStorage.$LoopBack$currentUserToken=JSON.stringify(e)}function auth2wechat(e,t,r,o,i,n){e.auth2wechat({code:r.code,state:r.state,action:r.action},function(e){t.user=e.token.user,t.aouth=e.aouth,"未知"===t.user.school&&(t.user.school="杭州电子科技大学"),userAuthSave(e.token,o,n),Materialize.toast("登录成功",2e3),t.aouth.iswechat&&i.path(t.aouth.url)},function(e){t.err=e,t.status="fail"})}app.controller("LoginController",["User","Aouth","$scope","$location","LoopBackAuth","$window","$rootScope","$http","$interval","$timeout",function(e,t,r,o,i,n,c,s,a,u){r.user={};var l="micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i);r.isWechart=l,r.changeInputType=!r.isWechart,r.loadURL=function(){n.location.href;return c.mediaIsPC||l?void s.get("/wechatUrl?iswechat="+l+"&url="+o.path()).success(function(e){if(r.wechatLogin=c.mediaIsPC,l)n.location.href=e.url;else{createQrcode(e.url,"qrcode");var s=!0,d=a(function(){t.findById({id:e.token},function(e){var t=e.token;t&&(a.cancel(d),"未知"===t.user.school&&(t.user.school="杭州电子科技大学",t.user.isVerify=!1),userAuthSave(t,c,i),r.wechatLogin=!1,Materialize.toast("登录成功",3e3),s=!1,e.aouth.url?(Materialize.toast("记得去完善资料",3e3),window.location.reload()):o.path("/u/info"))})},3e3);u(function(){s&&(Materialize.toast("验证超时，请在30秒内完成确认哦",3e3),document.getElementById("qrcode").innerHTML=null,r.wechatLogin=!1,t.deleteById({id:e.token}),a.cancel(d))},3e4)}}).error(function(e){console.log(e)}):void Materialize.toast("只能在微信中微信登录噢",3e3)},r.login=function(){r.user.password=hex_md5(r.user.password),e.login(r.user,function(e){r.user={},userAuthSave(e,c,i),Materialize.toast("登录成功",2e3),window.location.reload()},function(e){r.user.password=void 0,Materialize.toast("登录失败,请检查输入是否正确",2e3)})}}]),app.controller("OrgLoginController",["User","$scope","$location","LoopBackAuth","$rootScope",function(e,t,r,o,i){t.login=function(){e.login(t.user,function(e){userAuthSave(e,i,o),Materialize.toast("登录成功",2e3)})},t.resetPassword=function(){e.resetPassword({lastPwd:t.lastPwd,newPwd:hex_md5(t.newPwd)},function(e){Materialize.toast("密码修改成功,请记住新密码",2e3),r.path("/u/info")})}}]),app.controller("RegisterController",["User","School","$scope","$rootScope","$location","LoopBackAuth",function(e,t,r,o,i,n){r.user={},t.find(function(e){r.schools=e}),r.register=function(){r.user.password=hex_md5(r.user.password),e.create(r.user,function(e){userAuthSave(e,o,n),Materialize.toast("恭喜你，注册成功",2e3);var t="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx809e719f43b30edf&redirect_uri=http://"+i.host()+"/u/bind&response_type=code&scope=snsapi_userinfo&state="+e.userId+"#wechat_redirect";createQrcode(t,"bindQrcode"),r.regSuccess=!0},function(e){1e3===e.status&&Materialize.toast("该手机号已经被注册",2e3)})}}]),app.controller("ConfirmSchoolController",["User","$scope","School","$window",function(e,t,r,o){t.user=t.$currentUser,r.findOne({filter:{where:{name:t.$currentUser.school},fields:["academy"]}},function(e){t.academies=e[0].academy}),t.confirm=function(){e.confirmSchool({id:t.$currentUser.id},{studentId:t.studentId,password:hex_md5(t.studentPassword),academy:t.academy},function(e){t.$currentUser.studentId=studentId,Materialize.toast("验证成功",2e3),o.history.back()})}}]),app.controller("UserController",["$scope","User","$rootScope","$location","$stateParams",function(e,t,r,o,i){e.isAuthor=!i.id;var n=function(){t.getMyTeams({id:e.$currentUser.id},function(t){e.teams=t.teams.reverse()})},c=function(){t.getRaceHistories({id:e.$currentUser.id},function(t){e.races=t.races.reverse()})},s=function(){t.getActivitiesHistories({id:e.$currentUser.id},function(t){e.activities=t.activities.reverse()})},a=function(){t.getLikeArticles({id:e.$currentUser.id},function(t){e.likeArticles=t.articles.reverse()})},u=function(){t.prototype_get_articles({id:e.$currentUser.id},function(t){e.articles=t})};e.goLogin=function(){return e.$currentUser?void 0:e.$emit("auth:loginRequired")},e.deleteLike=function(){var r=this.likeArticle;t.prototype_get_likeUsers({id:e.$currentUser.id,filter:{where:{articleId:r.articleId}}},function(r){t.prototype_destroyById_likeUsers({id:e.$currentUser.id,fk:r[0].id},function(){Materialize.toast("文章取消收藏成功",2e3),e.likeArticles.splice(this.$index,1)})})},e.activeMenus=[{name:"我的团队",clickFn:n,active:!0,eName:"team"},{clickFn:c,name:"参赛竞赛",active:!1,eName:"race"},{clickFn:s,name:"活动历史",active:!1,eName:"activity"},{clickFn:a,name:"文章收藏",active:!1,eName:"article"}],e.logOut=function(){r.$currentUser=null,localStorage.clear(),r.username=!1,Materialize.toast("退出成功",2e3),o.path("/w/activities")},e.pullData=function(){return e.$currentUser?(e.activeMenus.forEach(function(e){e.active=!1}),this.menu.active=!0,this.menu.clickFn(),void(e.selectedMenu=this.menu.eName)):e.$emit("auth:loginRequired")},e.selectedMenu="team",e.$currentUser?(e.user=e.$currentUser,n(),u()):e.user=null}]),app.controller("AuthController",["$scope","User","$location","$rootScope","LoopBackAuth",function(e,t,r,o,i){var n="micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i),c=r.search();c.action="login",n&&c.code?(auth2wechat(t,e,c,o,r,i),r.search({})):e.status="fail",e.goLogin=function(){e.$emit("auth:loginRequired")}}]),app.controller("BindController",["$scope","User","$location","$rootScope","LoopBackAuth",function(e,t,r,o,i){var n="micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i),c=r.search();c.action="bind",n&&c.code?(auth2wechat(t,e,c,o,r,i),r.search({})):e.status="fail"}]),app.controller("UserInfoController",["$scope","User","School","$location","uploadFile",function(e,t,r,o,i){e.isBindWeChat=!1,console.log(e.$currentUser),e.$currentUser?(t.getInfo(function(t){delete t.$promise,delete t.$resolved,e.user=t}),r.find(function(t){e.schools=t})):(e.$emit("auth:loginRequired"),e.user=null),e.uploadLogo=function(){if(!e.$currentUser)return e.$emit("auth:loginRequired");var t=document.getElementById("headImg").files[0];i.img(t,"headImgUrl",e.$currentUser.id).success(function(t){e.user.headImgUrl=t.url})},e.closeBind=function(){e.isBindWeChat=!1},e.bindWechat=function(){e.isBindWeChat=!0;var t="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx809e719f43b30edf&redirect_uri=http://"+o.host()+"/u/bind&response_type=code&scope=snsapi_userinfo&state="+e.$currentUser.id+"#wechat_redirect";createQrcode(t,"bindQrcode")},e.updateInfo=function(){e.user.password&&(e.user.password=hex_md5(e.user.password)),t.prototype_updateAttributes(e.user,function(t){e.$currentUser.headImgUrl=t.headImgUrl,e.$currentUser.school=t.school,Materialize.toast("修改成功",2e3)})},e.resetPassword=function(){t.resetPassword({lastPwd:hex_md5(e.lastPwd),newPwd:hex_md5(e.newPwd)},function(e){Materialize.toast("修改成功,请记住新密码",2e3)})}}]),app.controller("RetController",["$scope",function(e){}]),app.controller("ActivityResultController",["$scope","$stateParams","User",function(e,t,r){return e.$currentUser?(e.type=t.type,void r["prototype_findById_"+t.type+"Results"]({id:e.$currentUser.id,fk:t.id},function(t){t.results.created=new Date(t.results.created).getTime()+50,e.results=t.results,e.activity=t.activity})):e.$emit("auth:loginRequired")}]),app.controller("MSController",["User","$stateParams",function(e,t){window.localStorage.$LoopBack$currentTeamId=t.id,window.location.href="/MS"}]),app.controller("ARTController",["$scope",function(){}]),app.controller("UserDetailController",["$scope","$stateParams","User",function(e,t,r){r.findById({id:t.id},function(t){e.user=t});var o=function(){r.getMyTeams({id:t.id},function(t){e.teams=t.teams.reverse()})},i=function(){r.getRaceHistories({id:t.id},function(t){e.races=t.races.reverse()})},n=function(){r.getActivitiesHistories({id:t.id},function(t){e.activities=t.activities.reverse()})},c=function(){r.getLikeArticles({id:t.id},function(t){e.likeArticles=t.articles.reverse()})},s=function(){r.prototype_get_articles({id:t.id},function(t){e.articles=t})};e.activeMenus=[{name:"我的团队",clickFn:o,active:!0,eName:"team"},{clickFn:i,name:"参赛竞赛",active:!1,eName:"race"},{clickFn:n,name:"活动历史",active:!1,eName:"activity"},{clickFn:c,name:"文章收藏",active:!1,eName:"article"}],e.pullData=function(){e.activeMenus.forEach(function(e){e.active=!1}),this.menu.active=!0,this.menu.clickFn(),e.selectedMenu=this.menu.eName},e.selectedMenu="team",t.id?(o(),s()):e.user=null}]);
app.config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("confirmSchool",{url:"/u/confirmSchool",controller:"ConfirmSchoolController",templateUrl:"application/views/confirm-school.html"}).state("register",{url:"/u/register",controller:"RegisterController",templateUrl:"application/views/user/register.html"}).state("index",{url:"/",controller:"HomeController",templateUrl:"/application/views/index.html"}).state("home",{url:"/u/home",controller:"UserController",templateUrl:"/application/views/user/index.html"}).state("detail",{url:"/u/detail/:id",controller:"UserDetailController",templateUrl:"/application/views/user/detail.html"}).state("info",{url:"/u/info",controller:"UserInfoController",templateUrl:"/application/views/user/info.html"}).state("retrieve",{url:"/u/retrieve",controller:"RetController",templateUrl:"/application/views/user/retrieve.html"}).state("auth",{url:"/u/auth",controller:"AuthController",templateUrl:"/application/views/user/auth.html"}).state("bind",{url:"/u/bind",controller:"BindController",templateUrl:"/application/views/user/bind.html"}).state("activityResult",{url:"/u/results/:id/:type",controller:"ActivityResultController",templateUrl:"/application/views/user/activity-result.html"}).state("orgLogin",{url:"/u/orgLogin",controller:"OrgLoginController",templateUrl:"/application/views/user/org-user-login.html"}).state("MS",{url:"/w/team/:id",controller:"MSController",template:"<div></div>"}).state("art",{url:"/w",controller:"ARTController",template:"<div ui-view></div>"})}]);
app.controller("TeamsController",["$scope","Team","User","$location","uploadFile","$window",function(e,t,a,n,i,o){e.filterBar="ng-hide",e.types=[{name:"校园组织"},{name:"校园团队"},{name:"兴趣团队"},{name:"竞赛团队"}],o.pull=!0,e.teams=[];var r=0;angular.element(o).bind("scroll",function(t){var a=t.target.body;a.scrollHeight-a.clientHeight-a.scrollTop<600&&o.pull&&!e.last?(e.getTeams(),o.pull=!1):a.scrollHeight-a.clientHeight-a.scrollTop>600&&(o.pull=!0)}),e.$on("$destroy",function(t,a){angular.element(o).unbind("scroll"),e.teams=void 0}),e.team={status:!1,hidden:!1},e.allStatusFilter=function(){e.query=void 0,e.status="状态"},e.statusFilter=function(){e.query={status:1},r=0,e.last=!1,e.teams=[],e.getTeams(),e.status="可加入"},e.organizationFilter=function(){e.query={type:"校园组织"},r=0,e.last=!1,e.teams=[],e.getTeams(),e.typeHide=!0,e.type="校园组织"},e.associationFilter=function(){e.query={type:"校园社团"},r=0,e.last=!1,e.teams=[],e.getTeams(),e.typeHide=!0,e.type="校园社团"},e.avocationFilter=function(){e.query={type:"兴趣团队"},r=0,e.last=!1,e.teams=[],e.getTeams(),e.typeHide=!0,e.type="兴趣团队"},e.raceFilter=function(){e.query={type:"竞赛团队"},r=0,e.last=!1,e.teams=[],e.getTeams(),e.typeHide=!0,e.type="竞赛团队"},e.allTypeFilter=function(){e.query=void 0,e.typeHide=!0,e.type="团队类型"},e.titleFilter=function(){this.filterTitle?e.query={name:this.filterTitle}:e.query=void 0},e.uploadLogo=function(){if(!e.$currentUser)return e.$emit("auth:loginRequired");var t=document.getElementById("teamlogo").files[0],a=(new XMLHttpRequest,/\.[^\.]+/.exec(document.getElementById("teamlogo").value.toLowerCase()));return".png"!==a[0]&&".jpg"!==a[0]&&".jpeg"!==a[0]&&".gif"!==a[0]?(alert("请确认您上传的logo文件格式是jpg、png、gif或jpeg"),!1):void i.img(t,"teamlogo",e.$currentUser.id).success(function(t){e.team.logoUrl=t.url})},e.getTeams=function(){if(!e.$currentUser)return void e.$emit("auth:loginRequired");var a=e.query||{};t.getMySchoolTeams({school:e.$currentUser.school,page:r,type:a.type,status:a.status},function(t){(t.teams.length<16||0===t.teams.length)&&(e.last=!0),r++,e.teams.push.apply(e.teams,t.teams)})},e.username?e.getTeams():t.find(function(t){e.teams=t}),e.createTeam=function(){return e.$currentUser?e.team.logoUrl?void a.prototype_create_teams({id:e.$currentUser.id},e.team,function(e){Materialize.toast("创建团队成功",2e3),n.path("/w/teams/"+e.id)}):Materialize.toast("团队logo未上传成功,请稍等",2e3):e.$emit("auth:loginRequired")}}]),app.controller("TeamController",["$scope","Team","$stateParams","User","$location","$timeout",function(e,t,a,n,i,o){function r(e){var t=new Date;try{new Date(e.ended)<t?e.status="end":new Date(e.started)>t?e.status="nos":e.status="ing"}catch(a){}}e.userInfomation={},e.teamId||(e.teamId=a.id),t.findById({id:e.teamId},function(t){e.team=t,e.$emit("shareContentArrive",{bdText:t.name,bdPic:t.logoUrl,bdDesc:t.desc})},function(){}),t.prototype_get_activities({id:e.teamId},function(t){e.activities=t,e.activities.forEach(function(e){r(e)})}),e.getUserInfo=function(){return e.$currentUser?void n.getInfo(function(t){e.user=t,t.studentId||(Materialize.toast("加入团队需要验证学号信息",2e3),o(function(){i.path("/u/confirmSchool")},1e3))}):e.$emit("auth:loginRequired")},e.join=function(){return e.$currentUser?void t.prototype_create_members({id:e.teamId},e.userInfomation,function(e){Materialize.toast("申请成功,等待管理员同意",2e3)},function(e){console.log(e),Materialize.toast(e.data.error.message,2e3)}):e.$emit("auth:loginRequired")}}]);
app.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("art.teams",{url:"/teams",controller:"TeamsController",templateUrl:"application/views/team/index.html"}).state("create",{url:"/w/teams/create",controller:"TeamsController",templateUrl:"application/views/team/create.html"}).state("team",{url:"/w/teams/:id",controller:"TeamController",templateUrl:"application/views/team/detail.html"})}]);
app.controller("RacesController",["$scope","Race","$window",function(e,t,i){i.pull=!0,e.raceItems=[],e.filterBar="ng-hide";var r=0;angular.element(i).bind("scroll",function(t){var r=t.target.body;r.scrollHeight-r.clientHeight-r.scrollTop<600&&i.pull?(e.getRaces(),i.pull=!1):r.scrollHeight-r.clientHeight-r.scrollTop>600&&(i.pull=!0)}),e.$on("$destroy",function(t,r){angular.element(i).unbind("scroll"),e.raceItems=void 0}),e.getRaces=function(){return e.$currentUser?void t.getMySchoolRaces({school:e.$currentUser.school,page:r},function(t){for(x in t)"races"===x&&((t[x].length<16||0===t[x].length)&&(e.last=!0),e.raceItems.push.apply(e.raceItems,t[x]),r++)}):void e.$emit("auth:loginRequired")},e.titleFilter=function(){this.filterTitle?e.query={name:this.filterTitle}:e.query=void 0},e.username?e.getRaces():t.find(function(t){e.raceItems=t})}]),app.controller("RaceController",["$scope","Race","$stateParams","User","Team",function(e,t,i,r,n){t.findById({id:i.id},function(t){e.race=t,e.$emit("shareContentArrive",{bdText:t.name,bdPic:t.imgUrl})}),t.prototype_get_materials({id:i.id},function(t){e.materials=t},function(){Materialize.toast("获取资料列表失败！",2e3)}),t.prototype_get_notices({id:i.id},function(t){e.notices=t}),t.prototype_get_raceTeams({id:i.id},function(t){e.raceTeams=t}),e.$currentUser&&r.prototype_get_teams({id:e.$currentUser.id},function(t){e.teams=t}),e.selectedTeam=function(){e.selected=this.team.id},e.joinRace=function(){return e.$currentUser?e.selected?void n.prototype_link_partakedRaces({id:e.selected,fk:i.id},{},function(e){Materialize.toast("参与成功,请经常关注竞赛信息",2e3)}):Materialize.toast("必须选择一个团队",2e3):e.$emit("auth:loginRequired")}}]);
app.config(["$stateProvider","$urlRouterProvider",function(e,r){e.state("art.races",{url:"/races",controller:"RacesController",templateUrl:"application/views/race/index.html"}).state("race",{url:"/w/races/:id",controller:"RaceController",templateUrl:"application/views/race/detail.html"})}]);
!function(e,t,r){"use strict";var o="/api",s="authorization",i=t.module("lbServices",["ngResource"]);i.factory("School",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Schools/:id",{id:"@id"},{find:{url:o+"/Schools",params:{filter:{fields:["name"]}},method:"GET",isArray:!0},findOne:{url:o+"/Schools",method:"GET",isArray:!0}});return s.modelName="School",s}]),i.factory("Aouth",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Aouths/:id",{id:"@id"},{findById:{url:o+"/Aouths/:id",method:"GET"},deleteById:{url:o+"/Aouths/:id",method:"DELETE"}});return s.modelName="Aouth",s}]),i.factory("User",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/WUsers/:id",{id:"@id"},{prototype_create_replys:{url:o+"/WUsers/:id/replys",method:"POST"},findById:{url:o+"/WUsers/:id",method:"GET"},prototype_create_comments:{url:o+"/WUsers/:id/comments",method:"POST"},prototype_create_articles:{url:o+"/WUsers/:id/articles",method:"POST"},prototype_get_likeUsers:{url:o+"/WUsers/:id/likeUsers",method:"GET",isArray:!0},prototype_create_likeUsers:{url:o+"/WUsers/:id/likeUsers",method:"POST"},prototype_destroyById_likeUsers:{url:o+"/WUsers/:id/likeUsers/:fk",method:"DELETE"},auth2wechat:{url:o+"/WUsers/auth2wechat",method:"GET"},checkPhone:{url:o+"/WUsers/:id/checkPhone",method:"GET"},updateAll:{url:o+"/WUsers/updateAll",method:"GET"},prototype_create_coteries:{url:o+"/WUsers/:id/coteries",method:"POST"},prototype_updateById_coteries:{url:o+"/WUsers/:id/coteries/:fk",params:{fk:"@fk"},method:"PUT"},prototype_get_teams:{url:o+"/WUsers/:id/teams",method:"GET",isArray:!0},prototype_get_articles:{url:o+"/WUsers/:id/articles",method:"GET",isArray:!0},prototype_get_coteries:{url:o+"/WUsers/:id/coteries",method:"GET",isArray:!0},create:{url:o+"/WUsers",method:"POST"},confirmSchool:{url:o+"/WUsers/:id/confirmSchool",method:"POST"},prototype_create_formResults:{url:o+"/WUsers/:id/formResults",method:"POST"},prototype_findById_formResults:{url:o+"/WUsers/:id/formResults/:fk",params:{fk:"@fk"},method:"GET"},prototype_create_voteResults:{url:o+"/WUsers/:id/voteResults",method:"POST"},prototype_findById_voteResults:{url:o+"/WUsers/:id/voteResults/:fk",params:{fk:"@fk"},method:"GET"},prototype_create_seckillResults:{url:o+"/WUsers/:id/seckillResults",method:"POST"},prototype_findById_seckillResults:{url:o+"/WUsers/:id/seckillResults/:fk",params:{fk:"@fk"},method:"GET"},getMyTeams:{url:o+"/WUsers/:id/myTeams",method:"GET"},getInfo:{url:o+"/WUsers/info",method:"GET"},getActivitiesHistories:{url:o+"/WUsers/:id/activitiesHistories",method:"GET"},getRaceHistories:{url:o+"/WUsers/:id/raceHistories",method:"GET"},getLikeArticles:{url:o+"/WUsers/:id/likeArticles",method:"GET"},prototype_updateAttributes:{url:o+"/WUsers/:id",method:"PUT"},prototype_create_teams:{url:o+"/WUsers/:id/teams",method:"POST"},resetPassword:{url:o+"/WUsers/reset",method:"POST"},prototype_updateById_teams:{url:o+"/WUsers/:id/teams/:fk",params:{fk:"@fk"},method:"PUT"},login:{url:o+"/WUsers/login",method:"POST",params:{include:"user"},interceptor:{response:function(e){var r=e.data;return t.setUser(r.id,r.userId,r.user),t.rememberMe=e.config.params.rememberMe!==!1,t.save(),e.resource}}}});return s}]).factory("Team",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Teams/:id",{id:"@id"},{find:{url:o+"/Teams",method:"GET",isArray:!0},prototype_link_partakedRaces:{url:o+"/Teams/:id/partakedRaces/rel/:fk",params:{fk:"@fk"},method:"PUT"},prototype_get_partakedRaces:{url:o+"/Teams/:id/partakedRaces",method:"GET",isArray:!0},prototype_unlink_partakedRaces:{url:o+"/Teams/:id/partakedRaces/rel/:fk",method:"DELETE"},getMySchoolTeams:{url:o+"/Teams/mySchoolTeams",method:"GET"},findById:{url:o+"/Teams/:id",method:"GET"},prototype_updateAttributes:{url:o+"/Teams/:id",method:"PUT"},prototype_get_activities:{url:o+"/Teams/:id/activities",method:"GET",isArray:!0},prototype_create_activities:{url:o+"/Teams/:id/activities",method:"POST"},prototype_create_forms:{url:o+"/Teams/:id/forms",method:"POST"},prototype_findById_forms:{url:o+"/Teams/:id/forms/:fk",method:"GET"},prototype_updateById_forms:{url:o+"/Teams/:id/forms/:fk",method:"PUT"},prototype_create_votes:{url:o+"/Teams/:id/votes",method:"POST"},prototype_findById_votes:{url:o+"/Teams/:id/votes/:fk",method:"GET"},prototype_updateById_votes:{url:o+"/Teams/:id/votes/:fk",method:"PUT"},prototype_create_seckills:{url:o+"/Teams/:id/seckills",method:"POST"},prototype_findById_seckills:{url:o+"/Teams/:id/seckills/:fk",method:"GET"},prototype_updateById_seckills:{url:o+"/Teams/:id/seckills/:fk",method:"PUT"},prototype_get_seckills:{url:o+"/Teams/:id/seckills",method:"GET",isArray:!0},prototype_destroyById_seckills:{url:o+"/Teams/:id/seckills/:fk",method:"DELETE"},prototype_get_forms:{url:o+"/Teams/:id/forms",method:"GET",isArray:!0},prototype_destroyById_forms:{url:o+"/Teams/:id/forms/:fk",method:"DELETE"},prototype_get_votes:{url:o+"/Teams/:id/votes",method:"GET",isArray:!0},prototype_destroyById_votes:{url:o+"/Teams/:id/votes/:fk",method:"DELETE"},prototype_updateById_activities:{url:o+"/Teams/:id/activities/:fk",method:"PUT"},prototype_findById_activities:{url:o+"/Teams/:id/activities/:fk",method:"GET"},prototype_create_members:{url:o+"/Teams/:id/members",method:"POST"},prototype_get_members:{url:o+"/Teams/:id/members",method:"GET",isArray:!0},prototype_findById_members:{url:o+"/Teams/:id/members/:fk",params:{fk:"@fk"},method:"GET"},prototype_destroyById_members:{url:o+"/Teams/:id/members/:fk",params:{fk:"@fk"},method:"DELETE"},prototype_updateById_members:{url:o+"/Teams/:id/members/:fk",params:{fk:"@fk"},method:"PUT"},prototype_create_departments:{url:o+"/Teams/:id/departments",method:"POST"},prototype_destroyById_departments:{url:o+"/Teams/:id/departments/:fk",params:{fk:"@fk"},method:"DELETE"},prototype_get_races:{url:o+"/Teams/:id/races",method:"GET",isArray:!0},prototype_create_races:{url:o+"/Teams/:id/races",method:"POST"},prototype_updateById_races:{url:o+"/Teams/:id/races/:fk",method:"PUT"},prototype_findById_races:{url:o+"/Teams/:id/races/:fk",method:"GET"}});return s}]).factory("Article",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Articles/:id",{id:"@id"},{findById:{url:o+"/Articles/:id",method:"GET"},prototype_get_comments:{url:o+"/Articles/:id/comments",method:"GET",isArray:!0},prototype_create_readers:{url:o+"/Articles/:id/readers",method:"POST"}});return s}]).factory("Comment",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Comments/:id",{id:"@id"},{prototype_get_replys:{url:o+"/Comments/:id/replys",method:"GET",isArray:!0}});return s}]).factory("Notice",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Notices/:id",{id:"@id"},{prototype_create_form:{url:o+"/Notices/:id/form",method:"POST"}});return s}]).factory("Coterie",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Coteries/:id",{id:"@id"},{prototype_count_fans:{url:o+"/Coteries/:id/fans/count",method:"GET"},find:{url:o+"/Coteries",method:"GET",isArray:!0},prototype_get_articles:{url:o+"/Coteries/:id/articles",method:"GET",isArray:!0},prototype_findById_articles:{url:o+"/Coteries/:id/articles/:fk",params:{fk:"@fk"},method:"GET"},findById:{url:o+"/Coteries/:id",method:"GET"}});return s}]).factory("Activity",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Activities/:id",{id:"@id"},{getHotActiveties:{url:o+"/Activities/hotActiveties",method:"GET",isArray:!0},find:{url:o+"/Activities",method:"GET",isArray:!0},prototype_get_forms:{url:o+"/Activities/:id/forms",method:"GET",isArray:!0},prototype_get_votes:{url:o+"/Activities/:id/votes",method:"GET",isArray:!0},prototype_updateById_votes:{url:o+"/Activities/:id/votes/:fk",method:"PUT"},prototype_updateById_seckills:{url:o+"/Activities/:id/seckills/:fk",method:"PUT"},prototype_get_seckills:{url:o+"/Activities/:id/seckills",method:"GET",isArray:!0},prototype_create_forms:{url:o+"/Activities/:id/forms",method:"POST"},prototype_create_votes:{url:o+"/Activities/:id/votes",method:"POST"},prototype_create_seckills:{url:o+"/Activities/:id/seckills",method:"POST"},prototype_updateById_forms:{url:o+"/Activities/:id/forms/:fk",method:"PUT"},prototype_delete_forms:{url:o+"/Activities/:id/forms",method:"DELETE"},prototype_delete_votes:{url:o+"/Activities/:id/votes",method:"DELETE"},prototype_delete_seckills:{url:o+"/Activities/:id/seckills",method:"DELETE"},getMySchoolActiveties:{url:o+"/Activities/mySchoolActiveties",method:"GET"},search:{url:o+"/Activities/search",method:"GET",isArray:!0},prototype_create_readers:{url:o+"/Activities/:id/readers",method:"POST"},findById:{url:o+"/Activities/:id",method:"GET"}});return s}]).factory("Seckill",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Seckills/:id",{id:"@id"},{prototype_get_seckillResults:{url:o+"/Seckills/:id/seckillResults",method:"GET",isArray:!0},prototype_updateById_seckillResults:{url:o+"/Seckills/:id/seckillResults/:fk",method:"PUT"}});return s}]).factory("Form",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Forms/:id",{id:"@id"},{prototype_get_formResults:{url:o+"/Forms/:id/formResults",method:"GET",isArray:!0},excel:{url:o+"/Forms/:id/excel",method:"GET"}});return s}]).factory("Vote",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Votes/:id",{id:"@id"},{prototype_get_voteResults:{url:o+"/Votes/:id/voteResults",method:"GET",isArray:!0}});return s}]).factory("Race",["LoopBackResource","LoopBackAuth","$injector",function(e,t,r){var s=e(o+"/Races/:id",{id:"@id"},{find:{url:o+"/Races",method:"GET",isArray:!0},getMySchoolRaces:{url:o+"/Races/mySchoolRaces",method:"GET"},findById:{url:o+"/Races/:id",method:"GET"},prototype_get_notices:{url:o+"/Races/:id/notices",method:"GET",params:{filter:{order:"id DESC",include:"form",where:{deleted:!1}}},isArray:!0},prototype_create_notices:{url:o+"/Races/:id/notices",method:"POST"},prototype_updateById_notices:{url:o+"/Races/:id/notices/:fk",method:"PUT"},prototype_get_raceTeams:{url:o+"/Races/:id/raceTeams",params:{filter:{fields:["id","name","logoUrl","status","desc"],include:{relation:"members",scope:{fields:["name","academy","userId","department","phone"]}}}},method:"GET",isArray:!0},prototype_unlink_raceTeams:{url:o+"/Races/:id/raceTeams/rel/:fk",method:"DELETE"},prototype_get_materials:{url:o+"/Races/:id/materials",method:"GET",isArray:!0},prototype_updateById_materials:{url:o+"/Races/:id/materials/:fk",method:"PUT"},prototype_destroyById_materials:{url:o+"/Races/:id/materials/:fk",method:"DELETE"},prototype_create_materials:{url:o+"/Races/:id/materials",method:"POST"}});return s}]).factory("LoopBackAuth",function(){function t(){var e=this;i.forEach(function(t){e[t]=s(t)}),this.rememberMe=r,this.currentUserData=null}function o(e,t,r){var o=d+t;null==r&&(r=""),e[o]=r}function s(e){var t=d+e;return localStorage[t]||sessionStorage[t]||null}var i=["accessTokenId","currentUserId"],d="$LoopBack$";return t.prototype.save=function(){var t=this,r=this.rememberMe?e.localStorage:e.sessionStorage;i.forEach(function(e){o(r,e,t[e])})},t.prototype.setUser=function(e,t,r){this.accessTokenId=e,this.currentUserId=t,this.currentUserData=r},t.prototype.clearUser=function(){this.accessTokenId=null,this.currentUserId=null,this.currentUserData=null},t.prototype.clearStorage=function(){i.forEach(function(e){o(sessionStorage,e,null),o(localStorage,e,null)})},new t}).config(["$httpProvider",function(e){e.interceptors.push("LoopBackAuthRequestInterceptor")}]).factory("LoopBackAuthRequestInterceptor",["$q","$rootScope","LoopBackAuth",function(e,t,i){return{request:function(t){if(t.url.substr(0,o.length)!==o)return t;if(i.accessTokenId)t.params=t.params||{},t.params.access_token=i.accessTokenId,t.headers[s]=i.accessTokenId;else if(t.__isGetCurrentUser__){var d={body:{error:{status:401}},status:401,config:t,headers:function(){return r}};return e.reject(d)}return t||e.when(t)},responseError:function(r){switch(r.status){case 401:"/api/WUsers/login"!==r.config.url&&t.$broadcast("auth:loginRequired");break;case 500:t.$broadcast("error:unknown",r)}return e.reject(r)}}}]).provider("LoopBackResource",function(){this.setAuthHeader=function(e){s=e},this.setUrlBase=function(e){o=e},this.getUrlBase=function(){return o},this.$get=["$resource",function(e){return function(t,r,o){var s=e(t,r,o);return s.prototype.$save=function(e,t){var r=s.upsert.call(this,{},this,e,t);return r.$promise||r},s}}]})}(window,window.angular);
!function(e){e.module("ue.config",[]).factory("Ueditor",["$rootScope",function(e){function r(){if(e.teamInfo)var r="team",t=e.teamInfo.id;else{if(!e.$currentUser)return;var r="user",t=e.$currentUser.id}var i="/ue/uploads?dir="+r+"&id="+t;return{serverUrl:i,toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","|","justifyleft","justifycenter","justifyright","justifyjustify","|","simpleupload","insertimage","attachment","insertvideo","music"]],initialFrameHeight:300,wordCount:!1,elementPathEnabled:!1,enableContextMenu:!1}}return{config:r()}}])}(window.angular);
!function(t){var e=t.module("ng.upload",[]);e.factory("uploadFile",["$http",function(e){return{file:function(a,n,o){var d=new FormData,i="/ue/uploads?dir="+n+"&id="+o+"&action=uploadfile";return d.append("file",a),e({url:i,data:d,method:"POST",headers:{"Content-Type":void 0},transformRequest:t.identity})},text:function(t,a,n){return e({url:"/ue/uploads?dir="+a+"&id="+n+"&action=uploadtext",method:"post",data:{content:t}})},img:function(a,n,o){var d=new FormData,i="/ue/uploads?dir="+n+"&id="+o+"&action=uploadimage";return d.append("file",a),e({url:i,data:d,method:"POST",headers:{"Content-Type":void 0},transformRequest:t.identity})}}}])}(window.angular);
!function(e){e.module("ui.materialize",["ui.materialize.ngModel","ui.materialize.collapsible","ui.materialize.toast","ui.materialize.sidenav","ui.materialize.material_select","ui.materialize.dropdown","ui.materialize.inputfield","ui.materialize.input_date","ui.materialize.tabs","ui.materialize.pagination","ui.materialize.pushpin","ui.materialize.scrollspy","ui.materialize.parallax","ui.materialize.modal","ui.materialize.tooltipped","ui.materialize.slider","ui.materialize.materialboxed"]),e.module("ui.materialize.ngModel",[]).directive("ngModel",["$timeout",function(e){return{restrict:"A",priority:-1,link:function(i,t,n){i.$watch(n.ngModel,function(i){e(function(){i?t.trigger("change"):void 0===t.attr("placeholder")&&(t.is(":focus")||t.trigger("blur"))})})}}}]),e.module("ui.materialize.slider",[]).directive("slider",["$timeout",function(i){return{restrict:"A",scope:{height:"=",transition:"=",interval:"=",indicators:"="},link:function(t,n,a){n.addClass("slider"),i(function(){n.slider({height:e.isDefined(t.height)?t.height:200,transition:e.isDefined(t.transition)?t.transition:500,interval:e.isDefined(t.interval)?t.interval:6e3,indicators:e.isDefined(t.indicators)?t.indicators:!0})})}}}]),e.module("ui.materialize.collapsible",[]).directive("collapsible",["$timeout",function(e){return{link:function(i,t,n){e(function(){t.collapsible()}),"watch"in n&&i.$watch(function(){return t[0].innerHTML},function(i,n){i!==n&&e(function(){t.collapsible()})})}}}]),e.module("ui.materialize.parallax",[]).directive("parallax",["$timeout",function(e){return{link:function(i,t,n){e(function(){t.parallax()})}}}]),e.module("ui.materialize.toast",[]).constant("toastConfig",{duration:3e3}).directive("toast",["toastConfig",function(i){return{scope:{message:"@",duration:"@",callback:"&"},link:function(t,n,a){n.bind(a.toast,function(){var n=e.isDefined(t.message)?t.message:"",o=e.isDefined(a.toastclass)?a.toastclass:"";Materialize.toast(n,t.duration?t.duration:i.duration,o,t.callback)})}}}]),e.module("ui.materialize.pushpin",[]).directive("pushpin",[function(){return{restrict:"AE",require:["?pushpinTop","?pushpinOffset","?pushpinBottom"],link:function(e,i,t){var n=t.pushpinTop||0,a=t.pushpinOffset||0,o=t.pushpinBottom||1/0;setTimeout(function(){i.pushpin({top:n,offset:a,bottom:o})},0)}}}]),e.module("ui.materialize.scrollspy",[]).directive("scrollspy",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){t.addClass("scrollspy"),e(function(){t.scrollSpy()})}}}]),e.module("ui.materialize.tabs",[]).directive("tabs",[function(){return{link:function(e,i,t){i.tabs()}}}]),e.module("ui.materialize.sidenav",[]).directive("sidenav",[function(){return{scope:{menuwidth:"@",closeonclick:"@"},link:function(i,t,n){t.sideNav({menuWidth:e.isDefined(i.menuwidth)?i.menuwidth:void 0,edge:n.sidenav?n.sidenav:"left",closeOnClick:e.isDefined(i.closeonclick)?"true"==i.closeonclick:void 0})}}}]),e.module("ui.materialize.material_select",[]).directive("materialSelect",["$compile","$timeout",function(e,i){return{link:function(t,n,a){function o(){n.siblings(".caret").remove(),n.material_select()}n.is("select")&&(e(n.contents())(t),i(o),a.ngModel&&t.$watch(a.ngModel,o),"watch"in a&&t.$watch(function(){return n[0].innerHTML},function(e,t){e!==t&&i(o)}))}}}]),e.module("ui.materialize.dropdown",[]).directive("dropdown",["$compile","$timeout",function(i,t){return{scope:{inDuration:"@",outDuration:"@",constrainWidth:"@",hover:"@",alignment:"@",gutter:"@",belowOrigin:"@"},link:function(n,a,o){t(function(){i(a.contents())(n),a.dropdown({inDuration:e.isDefined(n.inDuration)?n.inDuration:void 0,outDuration:e.isDefined(n.outDuration)?n.outDuration:void 0,constrain_width:e.isDefined(n.constrainWidth)?n.constrainWidth:void 0,hover:e.isDefined(n.hover)?n.hover:void 0,alignment:e.isDefined(n.alignment)?n.alignment:void 0,gutter:e.isDefined(n.gutter)?n.gutter:void 0,belowOrigin:e.isDefined(n.belowOrigin)?n.belowOrigin:void 0})})}}}]),e.module("ui.materialize.inputfield",[]).directive("inputField",["$compile","$timeout",function(i,t){return{transclude:!0,scope:{},link:function(i,n){t(function(){Materialize.updateTextFields(),n.find("> > .materialize-textarea").each(function(){var e=$(this);e.addClass("materialize-textarea"),e.trigger("autoresize");var n=e.attr("ng-model");n&&i.$parent.$watch(n,function(i,n){i!==n&&t(function(){e.trigger("autoresize")})})}),n.find("> > .materialize-textarea, > > input").each(function(i,t){t=e.element(t),t.siblings('span[class="character-counter"]').length||t.characterCounter()})})},template:'<div ng-transclude class="input-field"></div>'}}]),e.module("ui.materialize.input_date",[]).directive("inputDate",["$compile","$timeout",function(i,t){var n=$("<style>#inputCreated_root {outline: none;}</style>");$("html > head").append(n);var a=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,t=/[^-+\dA-Z]/g,n=function(e,i){for(e=String(e),i=i||2;e.length<i;)e="0"+e;return e};return function(o,r,l){var s=a;if(1!==arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(r=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");r=String(s.masks[r]||r||s.masks["default"]),"UTC:"==r.slice(0,4)&&(r=r.slice(4),l=!0);var d=l?"getUTC":"get",u=o[d+"Date"](),c=o[d+"Day"](),m=o[d+"Month"](),f=o[d+"FullYear"](),p=o[d+"Hours"](),v=o[d+"Minutes"](),g=o[d+"Seconds"](),h=o[d+"Milliseconds"](),y=l?0:o.getTimezoneOffset(),D={d:u,dd:n(u),ddd:s.i18n.dayNames[c],dddd:s.i18n.dayNames[c+7],m:m+1,mm:n(m+1),mmm:s.i18n.monthNames[m],mmmm:s.i18n.monthNames[m+12],yy:String(f).slice(2),yyyy:f,h:p%12||12,hh:n(p%12||12),H:p,HH:n(p),M:v,MM:n(v),s:g,ss:n(g),l:n(h,3),L:n(h>99?Math.round(h/10):h),t:12>p?"a":"p",tt:12>p?"am":"pm",T:12>p?"A":"P",TT:12>p?"AM":"PM",Z:l?"UTC":(String(o).match(i)||[""]).pop().replace(t,""),o:(y>0?"-":"+")+n(100*Math.floor(Math.abs(y)/60)+Math.abs(y)%60,4),S:["th","st","nd","rd"][u%10>3?0:(u%100-u%10!=10)*u%10]};return r.replace(e,function(e){return e in D?D[e]:e.slice(1,e.length-1)})}}();a.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},a.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,i){return a(this,e,i)};var o=function(e){return"[object Date]"===Object.prototype.toString.call(e)?!isNaN(e.getTime()):!1};return{require:"ngModel",scope:{container:"@",format:"@",formatSubmit:"@",monthsFull:"@",monthsShort:"@",weekdaysFull:"@",weekdaysLetter:"@",firstDay:"=",disable:"=",today:"=",clear:"=",close:"=",selectYears:"=",onStart:"&",onRender:"&",onOpen:"&",onClose:"&",onSet:"&",onStop:"&",ngReadonly:"=?",max:"@",min:"@"},link:function(n,a,r,l){l.$formatters.unshift(function(i){if(i){var t=new Date(i);return e.isDefined(n.format)?t.format(n.format):t.format("d mmmm, yyyy")}return null});var s=e.isDefined(n.monthsFull)?n.$eval(n.monthsFull):void 0,d=e.isDefined(n.monthsShort)?n.$eval(n.monthsShort):void 0,u=e.isDefined(n.weekdaysFull)?n.$eval(n.weekdaysFull):void 0,c=e.isDefined(n.weekdaysLetter)?n.$eval(n.weekdaysLetter):void 0;i(a.contents())(n),n.ngReadonly||t(function(){var i=a.pickadate({container:e.isDefined(n.container)?n.container:"body",format:e.isDefined(n.format)?n.format:void 0,formatSubmit:e.isDefined(n.formatSubmit)?n.formatSubmit:void 0,monthsFull:e.isDefined(s)?s:void 0,monthsShort:e.isDefined(d)?d:void 0,weekdaysFull:e.isDefined(u)?u:void 0,weekdaysLetter:e.isDefined(c)?c:void 0,firstDay:e.isDefined(n.firstDay)?n.firstDay:0,disable:e.isDefined(n.disable)?n.disable:void 0,today:e.isDefined(n.today)?n.today:void 0,clear:e.isDefined(n.clear)?n.clear:void 0,close:e.isDefined(n.close)?n.close:void 0,selectYears:e.isDefined(n.selectYears)?n.selectYears:void 0,onStart:e.isDefined(n.onStart)?function(){n.onStart()}:void 0,onRender:e.isDefined(n.onRender)?function(){n.onRender()}:void 0,onOpen:e.isDefined(n.onOpen)?function(){n.onOpen()}:void 0,onClose:e.isDefined(n.onClose)?function(){n.onClose()}:void 0,onSet:e.isDefined(n.onSet)?function(){n.onSet()}:void 0,onStop:e.isDefined(n.onStop)?function(){n.onStop()}:void 0}),t=i.pickadate("picker");n.$watch("max",function(e){if(t){var i=new Date(e);t.set({max:o(i)?i:!1})}}),n.$watch("min",function(e){if(t){var i=new Date(e);t.set({min:o(i)?i:!1})}})})}}}]),e.module("ui.materialize.pagination",[]).directive("pagination",function(){function e(e,i){e.List=[],e.Hide=!1,e.page=parseInt(e.page)||1,e.total=parseInt(e.total)||0,e.dots=e.dots||"...",e.ulClass=e.ulClass||i.ulClass||"pagination",e.adjacent=parseInt(e.adjacent)||2,e.activeClass="active",e.disabledClass="disabled",e.scrollTop=e.$eval(i.scrollTop),e.hideIfEmpty=e.$eval(i.hideIfEmpty),e.showPrevNext=e.$eval(i.showPrevNext)}function i(e,i){e.page>i&&(e.page=i),e.page<=0&&(e.page=1),e.adjacent<=0&&(e.adjacent=2),1>=i&&(e.Hide=e.hideIfEmpty)}function t(e,i){e.page!=i&&(e.page=i,e.paginationAction({page:i}),e.scrollTop&&scrollTo(0,0))}function n(e,i,n){var a=0;for(a=e;i>=a;a++){var o={value:a.toString(),liClass:n.page==a?n.activeClass:"waves-effect",action:function(){t(n,this.value)}};n.List.push(o)}}function a(e){e.List.push({value:e.dots})}function o(e,i){n(1,2,e),3!=i&&a(e)}function r(e,i,n){if(e.showPrevNext&&!(1>i)){var a,o,r;if("prev"===n){a=e.page-1<=0;var l=e.page-1<=0?1:e.page-1;o={value:"<<",title:"First Page",page:1},r={value:"<",title:"Previous Page",page:l}}else{a=e.page+1>i;var s=e.page+1>=i?i:e.page+1;o={value:">",title:"Next Page",page:s},r={value:">>",title:"Last Page",page:i}}var d=function(i,n){e.List.push({value:i.value,title:i.title,liClass:n?e.disabledClass:"",action:function(){n||t(e,i.page)}})};d(o,a),d(r,a)}}function l(e,i,t){t!=e-2&&a(i),n(e-1,e,i)}function s(t,a){if(t.pageSize&&!(t.pageSize<0)){e(t,a);var s,d=2*t.adjacent,u=Math.ceil(t.total/t.pageSize);if(i(t,u),r(t,u,"prev"),5+d>u)s=1,n(s,u,t);else{var c;t.page<=1+d?(s=1,c=2+d+(t.adjacent-1),n(s,c,t),l(u,t,c)):u-d>t.page&&t.page>d?(s=t.page-t.adjacent,c=t.page+t.adjacent,o(t,s),n(s,c,t),l(u,t,c)):(s=u-(1+d+(t.adjacent-1)),c=u,o(t,s),n(s,c,t))}r(t,u,"next")}}return{restrict:"EA",scope:{page:"=",pageSize:"=",total:"=",dots:"@",hideIfEmpty:"@",adjacent:"@",scrollTop:"@",showPrevNext:"@",paginationAction:"&",ulClass:"=?"},template:'<ul ng-hide="Hide" ng-class="ulClass"> <li ng-class="Item.liClass" ng-click="Item.action()" ng-repeat="Item in List"> <a href> <span ng-bind="Item.value"></span> </a></ul>',link:function(e,i,t){e.$watchCollection("[page, total, pageSize]",function(){s(e,t)})}}}),e.module("ui.materialize.modal",[]).directive("modal",["$compile","$timeout",function(i,t){return{scope:{dismissible:"=",opacity:"@",inDuration:"@",outDuration:"@"},link:function(n,a,o){t(function(){i(a.contents())(n),a.leanModal({dismissible:e.isDefined(n.dismissible)?n.dismissible:void 0,opacity:e.isDefined(n.opacity)?n.opacity:void 0,in_duration:e.isDefined(n.inDuration)?n.inDuration:void 0,out_duration:e.isDefined(n.outDuration)?n.outDuration:void 0})})}}}]),e.module("ui.materialize.tooltipped",[]).directive("tooltipped",["$compile","$timeout",function(e,i){return{restrict:"EA",scope:!0,link:function(t,n,a){n.addClass("tooltipped"),e(n.contents())(t),i(function(){n.tooltip()}),t.$on("$destroy",function(){n.tooltip("remove")})}}}]),e.module("ui.materialize.materialboxed",[]).directive("materialboxed",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){e(function(){t.materialbox()})}}}])}(angular);
function hex_md5(d){return binl2hex(core_md5(str2binl(d),d.length*chrsz))}function b64_md5(d){return binl2b64(core_md5(str2binl(d),d.length*chrsz))}function str_md5(d){return binl2str(core_md5(str2binl(d),d.length*chrsz))}function hex_hmac_md5(d,r){return binl2hex(core_hmac_md5(d,r))}function b64_hmac_md5(d,r){return binl2b64(core_hmac_md5(d,r))}function str_hmac_md5(d,r){return binl2str(core_hmac_md5(d,r))}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc")}function core_md5(d,r){d[r>>5]|=128<<r%32,d[(r+64>>>9<<4)+14]=r;for(var _=1732584193,m=-271733879,n=-1732584194,h=271733878,f=0;f<d.length;f+=16){var t=_,i=m,c=n,e=h;_=md5_ff(_,m,n,h,d[f+0],7,-680876936),h=md5_ff(h,_,m,n,d[f+1],12,-389564586),n=md5_ff(n,h,_,m,d[f+2],17,606105819),m=md5_ff(m,n,h,_,d[f+3],22,-1044525330),_=md5_ff(_,m,n,h,d[f+4],7,-176418897),h=md5_ff(h,_,m,n,d[f+5],12,1200080426),n=md5_ff(n,h,_,m,d[f+6],17,-1473231341),m=md5_ff(m,n,h,_,d[f+7],22,-45705983),_=md5_ff(_,m,n,h,d[f+8],7,1770035416),h=md5_ff(h,_,m,n,d[f+9],12,-1958414417),n=md5_ff(n,h,_,m,d[f+10],17,-42063),m=md5_ff(m,n,h,_,d[f+11],22,-1990404162),_=md5_ff(_,m,n,h,d[f+12],7,1804603682),h=md5_ff(h,_,m,n,d[f+13],12,-40341101),n=md5_ff(n,h,_,m,d[f+14],17,-1502002290),m=md5_ff(m,n,h,_,d[f+15],22,1236535329),_=md5_gg(_,m,n,h,d[f+1],5,-165796510),h=md5_gg(h,_,m,n,d[f+6],9,-1069501632),n=md5_gg(n,h,_,m,d[f+11],14,643717713),m=md5_gg(m,n,h,_,d[f+0],20,-373897302),_=md5_gg(_,m,n,h,d[f+5],5,-701558691),h=md5_gg(h,_,m,n,d[f+10],9,38016083),n=md5_gg(n,h,_,m,d[f+15],14,-660478335),m=md5_gg(m,n,h,_,d[f+4],20,-405537848),_=md5_gg(_,m,n,h,d[f+9],5,568446438),h=md5_gg(h,_,m,n,d[f+14],9,-1019803690),n=md5_gg(n,h,_,m,d[f+3],14,-187363961),m=md5_gg(m,n,h,_,d[f+8],20,1163531501),_=md5_gg(_,m,n,h,d[f+13],5,-1444681467),h=md5_gg(h,_,m,n,d[f+2],9,-51403784),n=md5_gg(n,h,_,m,d[f+7],14,1735328473),m=md5_gg(m,n,h,_,d[f+12],20,-1926607734),_=md5_hh(_,m,n,h,d[f+5],4,-378558),h=md5_hh(h,_,m,n,d[f+8],11,-2022574463),n=md5_hh(n,h,_,m,d[f+11],16,1839030562),m=md5_hh(m,n,h,_,d[f+14],23,-35309556),_=md5_hh(_,m,n,h,d[f+1],4,-1530992060),h=md5_hh(h,_,m,n,d[f+4],11,1272893353),n=md5_hh(n,h,_,m,d[f+7],16,-155497632),m=md5_hh(m,n,h,_,d[f+10],23,-1094730640),_=md5_hh(_,m,n,h,d[f+13],4,681279174),h=md5_hh(h,_,m,n,d[f+0],11,-358537222),n=md5_hh(n,h,_,m,d[f+3],16,-722521979),m=md5_hh(m,n,h,_,d[f+6],23,76029189),_=md5_hh(_,m,n,h,d[f+9],4,-640364487),h=md5_hh(h,_,m,n,d[f+12],11,-421815835),n=md5_hh(n,h,_,m,d[f+15],16,530742520),m=md5_hh(m,n,h,_,d[f+2],23,-995338651),_=md5_ii(_,m,n,h,d[f+0],6,-198630844),h=md5_ii(h,_,m,n,d[f+7],10,1126891415),n=md5_ii(n,h,_,m,d[f+14],15,-1416354905),m=md5_ii(m,n,h,_,d[f+5],21,-57434055),_=md5_ii(_,m,n,h,d[f+12],6,1700485571),h=md5_ii(h,_,m,n,d[f+3],10,-1894986606),n=md5_ii(n,h,_,m,d[f+10],15,-1051523),m=md5_ii(m,n,h,_,d[f+1],21,-2054922799),_=md5_ii(_,m,n,h,d[f+8],6,1873313359),h=md5_ii(h,_,m,n,d[f+15],10,-30611744),n=md5_ii(n,h,_,m,d[f+6],15,-1560198380),m=md5_ii(m,n,h,_,d[f+13],21,1309151649),_=md5_ii(_,m,n,h,d[f+4],6,-145523070),h=md5_ii(h,_,m,n,d[f+11],10,-1120210379),n=md5_ii(n,h,_,m,d[f+2],15,718787259),m=md5_ii(m,n,h,_,d[f+9],21,-343485551),_=safe_add(_,t),m=safe_add(m,i),n=safe_add(n,c),h=safe_add(h,e)}return Array(_,m,n,h)}function md5_cmn(d,r,_,m,n,h){return safe_add(bit_rol(safe_add(safe_add(r,d),safe_add(m,h)),n),_)}function md5_ff(d,r,_,m,n,h,f){return md5_cmn(r&_|~r&m,d,r,n,h,f)}function md5_gg(d,r,_,m,n,h,f){return md5_cmn(r&m|_&~m,d,r,n,h,f)}function md5_hh(d,r,_,m,n,h,f){return md5_cmn(r^_^m,d,r,n,h,f)}function md5_ii(d,r,_,m,n,h,f){return md5_cmn(_^(r|~m),d,r,n,h,f)}function core_hmac_md5(d,r){var _=str2binl(d);_.length>16&&(_=core_md5(_,d.length*chrsz));for(var m=Array(16),n=Array(16),h=0;16>h;h++)m[h]=909522486^_[h],n[h]=1549556828^_[h];var f=core_md5(m.concat(str2binl(r)),512+r.length*chrsz);return core_md5(n.concat(f),640)}function safe_add(d,r){var _=(65535&d)+(65535&r),m=(d>>16)+(r>>16)+(_>>16);return m<<16|65535&_}function bit_rol(d,r){return d<<r|d>>>32-r}function str2binl(d){for(var r=Array(),_=(1<<chrsz)-1,m=0;m<d.length*chrsz;m+=chrsz)r[m>>5]|=(d.charCodeAt(m/chrsz)&_)<<m%32;return r}function binl2str(d){for(var r="",_=(1<<chrsz)-1,m=0;m<32*d.length;m+=chrsz)r+=String.fromCharCode(d[m>>5]>>>m%32&_);return r}function binl2hex(d){for(var r=hexcase?"0123456789ABCDEF":"0123456789abcdef",_="",m=0;m<4*d.length;m++)_+=r.charAt(d[m>>2]>>m%4*8+4&15)+r.charAt(d[m>>2]>>m%4*8&15);return _}function binl2b64(d){for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_="",m=0;m<4*d.length;m+=3)for(var n=(d[m>>2]>>8*(m%4)&255)<<16|(d[m+1>>2]>>8*((m+1)%4)&255)<<8|d[m+2>>2]>>8*((m+2)%4)&255,h=0;4>h;h++)_+=8*m+6*h>32*d.length?b64pad:r.charAt(n>>6*(3-h)&63);return _}var hexcase=0,b64pad="",chrsz=8;